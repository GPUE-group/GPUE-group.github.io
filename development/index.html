<!DOCTYPE html>
<html>
  <head>
    <title>GPUE</title>
    
      <meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">
<meta name="generator" content="Hugo 0.46" />
<title>Development :: GPUE</title>
<link rel="shortcut icon" href="/images/favicon.png" type="image/x-icon" />
<link href="/css/font-awesome.min.css" rel="stylesheet">
<link href="/css/nucleus.css" rel="stylesheet">
<link href="/theme-flex/style.css" rel="stylesheet">

	<link href="/theme-flex/variant-blue.css" rel="stylesheet">

<link rel="stylesheet" href="/css/bootstrap.min.css">
<script src="/js/jquery-2.x.min.js"></script>
<script type="text/javascript">
      var baseurl = "https:\/\/gpue-group.github.io\/";
</script>
<meta name="description" content="">



    
  </head>
  <body data-url="/development/">
    
      <header>
  <div class="logo">
    
	
  
    <a class="baselink" href="https://gpue-group.github.io/">GPUE</a>
  

  </div>
  <div class="burger"><a href="javascript:void(0);" style="font-size:15px;">&#9776;</a></div>
</header>
<article>
  <aside>
    <ul class="menu">
          <li data-nav-id="/" class="dd-item">
          <a href="/">
            <i class="fa fa-fw fa-home"></i>
          </a>
          </li>
    <li data-nav-id="/intro/" class="dd-item alwaysopen haschildren
        ">
      <div>
      <a href="/intro/">Introduction to GPUE</a>
            <i class="fa fa-angle-down fa-lg category-icon"></i><i class="fa fa-circle-thin read-icon"></i>
      </div>
        <ul>
      <li data-nav-id="/intro/gpue_intro/" class="dd-item">
        <div>
          <a href="/intro/gpue_intro/">
            
          </a><i class="fa fa-circle-thin read-icon"></i>
        </div>
    </li>
        </ul>
    </li>
    <li data-nav-id="/build/" class="dd-item alwaysopen haschildren
        ">
      <div>
      <a href="/build/">Building GPUE</a>
            <i class="fa fa-angle-down fa-lg category-icon"></i><i class="fa fa-circle-thin read-icon"></i>
      </div>
        <ul>
      <li data-nav-id="/build/gpue_build/" class="dd-item">
        <div>
          <a href="/build/gpue_build/">
            
          </a><i class="fa fa-circle-thin read-icon"></i>
        </div>
    </li>
        </ul>
    </li>
    <li data-nav-id="/functionality/" class="dd-item alwaysopen haschildren
        ">
      <div>
      <a href="/functionality/">GPUE functionality</a>
            <i class="fa fa-angle-down fa-lg category-icon"></i><i class="fa fa-circle-thin read-icon"></i>
      </div>
        <ul>
    <li data-nav-id="/functionality/running_gpue/" class="dd-item alwaysopen
        ">
      <div>
      <a href="/functionality/running_gpue/">Running GPUE</a><i class="fa fa-circle-thin read-icon"></i>
      </div>
    </li>
    <li data-nav-id="/functionality/gauge/" class="dd-item alwaysopen
        ">
      <div>
      <a href="/functionality/gauge/">Gauge Fields</a><i class="fa fa-circle-thin read-icon"></i>
      </div>
    </li>
    <li data-nav-id="/functionality/vortex_2d/" class="dd-item alwaysopen
        ">
      <div>
      <a href="/functionality/vortex_2d/">2D Vortex Tracking</a><i class="fa fa-circle-thin read-icon"></i>
      </div>
    </li>
    <li data-nav-id="/functionality/dynamic_fields/" class="dd-item alwaysopen
        ">
      <div>
      <a href="/functionality/dynamic_fields/">Dynamic Fields</a><i class="fa fa-circle-thin read-icon"></i>
      </div>
    </li>
      <li data-nav-id="/functionality/gpue_functionality/" class="dd-item">
        <div>
          <a href="/functionality/gpue_functionality/">
            
          </a><i class="fa fa-circle-thin read-icon"></i>
        </div>
    </li>
        </ul>
    </li>
    <li data-nav-id="/data_analysis/" class="dd-item alwaysopen haschildren
        ">
      <div>
      <a href="/data_analysis/">Data analysis</a>
            <i class="fa fa-angle-down fa-lg category-icon"></i><i class="fa fa-circle-thin read-icon"></i>
      </div>
        <ul>
    <li data-nav-id="/data_analysis/output/" class="dd-item alwaysopen
        ">
      <div>
      <a href="/data_analysis/output/">GPUE Output Format</a><i class="fa fa-circle-thin read-icon"></i>
      </div>
    </li>
    <li data-nav-id="/data_analysis/python/" class="dd-item alwaysopen
        ">
      <div>
      <a href="/data_analysis/python/">Python Scripts</a><i class="fa fa-circle-thin read-icon"></i>
      </div>
    </li>
    <li data-nav-id="/data_analysis/matlab/" class="dd-item alwaysopen
        ">
      <div>
      <a href="/data_analysis/matlab/">Matlab Scripts</a><i class="fa fa-circle-thin read-icon"></i>
      </div>
    </li>
      <li data-nav-id="/data_analysis/gpue_build/" class="dd-item">
        <div>
          <a href="/data_analysis/gpue_build/">
            
          </a><i class="fa fa-circle-thin read-icon"></i>
        </div>
    </li>
        </ul>
    </li>
    <li data-nav-id="/development/" class="dd-item parent active alwaysopen haschildren
        ">
      <div>
      <a href="/development/">Development</a>
            <i class="fa fa-angle-down fa-lg category-icon"></i><i class="fa fa-circle-thin read-icon"></i>
      </div>
        <ul>
      <li data-nav-id="/development/gpue_build/" class="dd-item">
        <div>
          <a href="/development/gpue_build/">
            
          </a><i class="fa fa-circle-thin read-icon"></i>
        </div>
    </li>
      <li data-nav-id="/development/html/" class="dd-item">
        <div>
          <a href="/development/html/">
            
          </a><i class="fa fa-circle-thin read-icon"></i>
        </div>
    </li>
        </ul>
    </li>




    </ul>
    <section>
    </section>
  </aside>
  <section class="page">
    
    <div class="nav-select">
      <center>Navigation : 
        <select onchange="javascript:location.href = this.value;">
          
    <option value="/intro/" >
   Introduction to GPUE</option> 
      <option value="/intro/gpue_intro/" >- </option>
  
    <option value="/build/" >
   Building GPUE</option> 
      <option value="/build/gpue_build/" >- </option>
  
    <option value="/functionality/" >
   GPUE functionality</option> 
    <option value="/functionality/running_gpue/" >
  - 
   Running GPUE</option> 
  
    <option value="/functionality/gauge/" >
  - 
   Gauge Fields</option> 
  
    <option value="/functionality/vortex_2d/" >
  - 
   2D Vortex Tracking</option> 
  
    <option value="/functionality/dynamic_fields/" >
  - 
   Dynamic Fields</option> 
  
      <option value="/functionality/gpue_functionality/" >- </option>
  
    <option value="/data_analysis/" >
   Data analysis</option> 
    <option value="/data_analysis/output/" >
  - 
   GPUE Output Format</option> 
  
    <option value="/data_analysis/python/" >
  - 
   Python Scripts</option> 
  
    <option value="/data_analysis/matlab/" >
  - 
   Matlab Scripts</option> 
  
      <option value="/data_analysis/gpue_build/" >- </option>
  
    <option value="/development/"  selected>
   Development</option> 
      <option value="/development/gpue_build/" >- </option>
      <option value="/development/html/" >- </option>
  



        </select>
      </center>
    </div>
      <div>
        <div class="searchbox">
          <input data-search-input id="search-by" type="text" placeholder="Search...">
        </div>
        <script type="text/javascript" src="/js/lunr.min.js"></script>
        <script type="text/javascript" src="/js/auto-complete.js"></script>
        <link href="/css/auto-complete.css" rel="stylesheet">
        <script type="text/javascript">
          
              var baseurl = "https:\/\/gpue-group.github.io\/";
          
        </script>
        <script type="text/javascript" src="/js/search.js"></script>
      </div>
    

    <h1>Development</h1>
    
    
    



<p>Here is the <a href="html/">DOXYGEN generated documentation</a>.</p>

<p>This section is devoted to particularly difficult or tricky parts of the GPUE codebase that deserve special attention for future development.
More information will come as features are developed.</p>

<h2 id="cufft-usage-with-angular-momentum-gauge-fields">CuFFT usage with angular momentum/gauge fields</h2>

<p>To implement angular momentum in the split-operator based pseudo-spectral methods, we must take special care of these evolution operators. As outlined in <a href="https://oist.repo.nii.ac.jp/?action=pages_view_main&amp;active_action=repository_view_main_item_detail&amp;item_id=182&amp;item_no=1&amp;page_id=15&amp;block_id=79">O&rsquo;Riordan, 2017</a>, th non-commutative nature of the position and momentum space operators required for angular momentum present a challenge &mdash; we cannot truly implment a numerical model without a certain degree of error. This is well documented in the above literature, though what is not discussed is an implementation of this method using CUDA and the CuFFT library.</p>

<p>Let&rsquo;s assume that we have a 3D dataset, with the data layout given by the following figure:</p>

<table>
<thead>
<tr>
<th align="left"><img src="/img/fft_fig.png" alt="FFT angular momentum operation" /></th>
</tr>
</thead>

<tbody>
<tr>
<td align="left"><strong>Fig. 1:</strong> <em>Data layout for a $2\times 2\times 2$ grid.</em></td>
</tr>
</tbody>
</table>

<p>For simplicity we assume a $2\times 2\times 2$ grid, giving us 8 data elements. Here we assume indexing is performed along $(x,y,z)$, where $x$ is the fastest axis and $z$ is the slowest axis.</p>

<p>For rotation about a specific axis, we assume that the applied operator is applied in a planar (2D) manner that is constant along this axis. In other words, $\Omega_z = x\p_y - yp_x$. For our split-operator method, we attain the $k$-space basis along a specific axis by performing a Fourier transform along this axis, and with appropriate scaling the resulting momentum space basis.</p>

<p>Let us now look at the layout of the data in memory for the above $2^3$ cube. In the given layout, keeping $y,z$ constant, all $x$ data elements are adjacent. This is optimal for computational performance, as CUDA loads data in the width of warps at any instance. Data loads are expensive, and to allow for the best performance we must keep loads (aka reads) to a minimum. To act along the $x$ axis, given that the data is always adjacent, Fourier transforms can be nicely batched to transform each respective $x$, for each combination of $y,z$.</p>

<table>
<thead>
<tr>
<th align="left"><img src="/img/fft_fig2.png" alt="FFT angular momentum operation" /></th>
</tr>
</thead>

<tbody>
<tr>
<td align="left"><strong>Fig. 2:</strong> <em>Memory locations and connections for data along each respective axis. $x$-axis data is adjacent, and hence is the fastest to process as data is chunks of CUDA warp sizes. The dashed straight lines represent the individual divisions between indendent data for transforming. The curved lines show the links between data of the same (dependent) transforms.</em></td>
</tr>
</tbody>
</table>

<p>If we wish to transform along one of the other axes, say $y$, this becomes a challenge, as the data layout is no longer adjacent. To calculate $\Omega_z$ we require the calculation of $p_x$ and $p_y$, thus we must deal with this non-adjacency for any rotation operations. The CuFFT API supports 1D, 2D, 3D, and n-D transforms, but only assumes transforms are performed over all dimensions of a dataset (ie, there are no functions for selective transformation of a single axis). One might say, that this is appropriately solved by a transpose in 2D, or a permutation in 3+ dimensions. As of the time of writing, no open-source in-place memory transpose/permutations exists, and out-of-place is not an option to enable storage of 3D data sets on the GPU. CuFFT has internal tranpose operations, but none that are publically exposed (these functions are called as part of the FFT transform calls, and observable in <code>cuda-gdb</code> or <code>nvprof</code>).</p>

<p>An initial implementation to calculate the appropriately transformed data using the in-built CuFFT functions can be performed by batching 1D FFT&rsquo;s for the adjacent ($x$) data set, and 2D forward-1D invserse (2DF-1DI) for the non-adjacent ($y$) data. This transforms the data along a 2D slice, and inverses the adjacent data set, so the remaining data set is the Fourier transformed non-adjacent data. However, this method is extremely inefficient, as it performs many more transforms than necessary. We can instead manipulate the data by appropriately batched CuFFT tranforms, making use of the manual control provided by <code>cufftPlanMany</code>, wherein we can control the stride, distance, offsets and size of the data being transformed. While not as performant as an FFT over adjacent data, the prior constraint of no out-of-place transposes/permutes is maintained as we are strictly using CuFFT function calls, leaving the underlying implementation to manipulate the data transforms.</p>

<table>
<thead>
<tr>
<th align="center">Param</th>
<th align="left">Property</th>
</tr>
</thead>

<tbody>
<tr>
<td align="center"><code>inembed</code></td>
<td align="left">Number of elements in input data to be transformed</td>
</tr>

<tr>
<td align="center"><code>onembed</code></td>
<td align="left">Number of elements in output data following transform</td>
</tr>

<tr>
<td align="center"><code>idist</code></td>
<td align="left">Spacing between consecutive input data sets in memory for batched transforms</td>
</tr>

<tr>
<td align="center"><code>odist</code></td>
<td align="left">Spacing between consecutive output data sets in memory following batched transforms</td>
</tr>

<tr>
<td align="center"><code>istride</code></td>
<td align="left">Spacing between input data elements in the same dataset in memory</td>
</tr>

<tr>
<td align="center"><code>ostride</code></td>
<td align="left">Spacing between output data elements in the same dataset in memory</td>
</tr>

<tr>
<td align="center"><code>batch</code></td>
<td align="left">Number of transforms to perform in batched mode</td>
</tr>
</tbody>
</table>

<p>The following script demonstrates the use of the above parameters to control the transforms in 2D and 3D. The transform of the fast-axis ($x$) data is simply performed by using batched 1D transforms using <code>cufftPlan1d</code>, with the comparative result obtained also from the <code>cufftPlanMany</code> method using the above parameters. To transform the non-adjacent ($y$) data, first we examine the 2DF-1DI result as previously mentioned, and compare the result with the <code>cufftPlanMany</code> method. In 2D this is natively supported by giving the above parameters the appropriate values for the data set. In 3+ dimensions it is worth noting that for this to work we must shift the pointer of the data by the product of the length of all faster axes dimensions. The slowest axis can simply be treated then without any need for pointer shifting. The earlier figure shows dotted lines wherever the transform boundaries do not cross.</p>
<div class="highlight"><pre style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-c++" data-lang="c++"><span style="color:#75715e">#include</span> <span style="color:#75715e">&lt;stdio.h&gt;</span><span style="color:#75715e">
</span><span style="color:#75715e">#include</span> <span style="color:#75715e">&lt;cstdlib&gt;</span><span style="color:#75715e">
</span><span style="color:#75715e">#include</span> <span style="color:#75715e">&lt;cufft.h&gt;</span><span style="color:#75715e">
</span><span style="color:#75715e">#include</span> <span style="color:#75715e">&lt;cuda.h&gt;</span><span style="color:#75715e">
</span><span style="color:#75715e">#include</span> <span style="color:#75715e">&lt;iostream&gt;</span><span style="color:#75715e">
</span><span style="color:#75715e">#include</span> <span style="color:#75715e">&lt;assert.h&gt;</span><span style="color:#75715e">
</span><span style="color:#75715e"></span>
<span style="color:#75715e">// ********************************************************* //
</span><span style="color:#75715e">// Error checking macros
</span><span style="color:#75715e">// ********************************************************* //
</span><span style="color:#75715e"></span>
<span style="color:#75715e">#define ERR_CHECK(err_val) {                                    \
</span><span style="color:#75715e"></span>    <span style="color:#111">cudaError_t</span> <span style="color:#111">err</span> <span style="color:#f92672">=</span> <span style="color:#111">err_val</span><span style="color:#111">;</span>                                  \
    <span style="color:#00a8c8">if</span> <span style="color:#111">(</span><span style="color:#111">err</span> <span style="color:#f92672">!=</span> <span style="color:#111">cudaSuccess</span><span style="color:#111">)</span> <span style="color:#111">{</span>                                   \
        <span style="color:#111">fprintf</span><span style="color:#111">(</span><span style="color:#111">stderr</span><span style="color:#111">,</span> <span style="color:#d88200">&#34;Error %s at line %d in file %s</span><span style="color:#8045ff">\n</span><span style="color:#d88200">&#34;</span><span style="color:#111">,</span>     \
                <span style="color:#111">cudaGetErrorString</span><span style="color:#111">(</span><span style="color:#111">err</span><span style="color:#111">),</span> <span style="color:#111">__LINE__</span><span style="color:#111">,</span> <span style="color:#111">__FILE__</span><span style="color:#111">);</span>   \
        <span style="color:#111">exit</span><span style="color:#111">(</span><span style="color:#ae81ff">1</span><span style="color:#111">);</span>                                                \
    <span style="color:#111">}</span>                                                           \
<span style="color:#111">}</span>

<span style="color:#75715e">#define FFT_ERR_CHECK(err_val) {                                \
</span><span style="color:#75715e"></span>    <span style="color:#111">cufftResult</span> <span style="color:#111">err</span> <span style="color:#f92672">=</span> <span style="color:#111">err_val</span><span style="color:#111">;</span>                                  \
    <span style="color:#00a8c8">if</span> <span style="color:#111">(</span><span style="color:#111">err</span> <span style="color:#f92672">!=</span> <span style="color:#111">CUFFT_SUCCESS</span><span style="color:#111">)</span> <span style="color:#111">{</span>                                 \
        <span style="color:#111">fprintf</span><span style="color:#111">(</span><span style="color:#111">stderr</span><span style="color:#111">,</span> <span style="color:#d88200">&#34;Error %d at line %d in file %s</span><span style="color:#8045ff">\n</span><span style="color:#d88200">&#34;</span><span style="color:#111">,</span>     \
                <span style="color:#111">err</span><span style="color:#111">,</span> <span style="color:#111">__LINE__</span><span style="color:#111">,</span> <span style="color:#111">__FILE__</span><span style="color:#111">);</span>                       \
        <span style="color:#111">exit</span><span style="color:#111">(</span><span style="color:#ae81ff">1</span><span style="color:#111">);</span>                                                \
    <span style="color:#111">}</span>                                                           \
<span style="color:#111">}</span>

<span style="color:#75715e">// ********************************************************* //
</span><span style="color:#75715e">// FT params for ...many plans
</span><span style="color:#75715e">// ********************************************************* //
</span><span style="color:#75715e"></span>
<span style="color:#00a8c8">typedef</span> <span style="color:#00a8c8">struct</span> <span style="color:#111">FTParams</span><span style="color:#111">{</span>
    <span style="color:#00a8c8">int</span> <span style="color:#111">numTranforms</span><span style="color:#111">;</span>
    <span style="color:#00a8c8">int</span> <span style="color:#111">numLoops</span><span style="color:#111">;</span>
    <span style="color:#00a8c8">int</span> <span style="color:#111">stride</span><span style="color:#111">;</span>
    <span style="color:#00a8c8">int</span> <span style="color:#111">dist</span><span style="color:#111">;</span>
    <span style="color:#00a8c8">int</span> <span style="color:#111">offset</span><span style="color:#111">;</span>
<span style="color:#111">};</span>

<span style="color:#75715e">// ********************************************************* //
</span><span style="color:#75715e">// Sample cuda kernels
</span><span style="color:#75715e">// ********************************************************* //
</span><span style="color:#75715e"></span>
<span style="color:#111">__host__</span> <span style="color:#111">__device__</span> <span style="color:#00a8c8">double</span> <span style="color:#75af00">retVal</span><span style="color:#111">(</span><span style="color:#00a8c8">double</span> <span style="color:#111">val</span><span style="color:#111">)</span> <span style="color:#111">{</span>
    <span style="color:#00a8c8">return</span> <span style="color:#111">val</span><span style="color:#111">;</span>
<span style="color:#111">}</span>

<span style="color:#111">__global__</span> <span style="color:#00a8c8">void</span> <span style="color:#75af00">copyVal</span><span style="color:#111">(</span><span style="color:#00a8c8">double</span> <span style="color:#f92672">*</span><span style="color:#111">inData</span><span style="color:#111">,</span> <span style="color:#00a8c8">double</span> <span style="color:#f92672">*</span><span style="color:#111">outData</span><span style="color:#111">)</span> <span style="color:#111">{</span>
    <span style="color:#111">outData</span><span style="color:#111">[</span><span style="color:#111">threadIdx</span><span style="color:#111">.</span><span style="color:#111">x</span><span style="color:#111">]</span> <span style="color:#f92672">=</span> <span style="color:#111">inData</span><span style="color:#111">[</span><span style="color:#111">threadIdx</span><span style="color:#111">.</span><span style="color:#111">x</span><span style="color:#111">];</span>
<span style="color:#111">}</span>

<span style="color:#75715e">// ********************************************************* //
</span><span style="color:#75715e">// FT test functions
</span><span style="color:#75715e">// ********************************************************* //
</span><span style="color:#75715e"></span>
<span style="color:#00a8c8">void</span> <span style="color:#75af00">fftIt2D</span><span style="color:#111">(){</span>
    <span style="color:#111">cudaDeviceReset</span><span style="color:#111">();</span>
    <span style="color:#00a8c8">int</span> <span style="color:#111">dimSize</span> <span style="color:#f92672">=</span> <span style="color:#ae81ff">6</span><span style="color:#111">;</span>
    <span style="color:#00a8c8">int</span> <span style="color:#111">NX</span> <span style="color:#f92672">=</span> <span style="color:#111">dimSize</span><span style="color:#f92672">*</span><span style="color:#111">dimSize</span><span style="color:#111">;</span>

    <span style="color:#00a8c8">int</span> <span style="color:#111">numTransform</span> <span style="color:#f92672">=</span> <span style="color:#111">std</span><span style="color:#f92672">::</span><span style="color:#111">round</span><span style="color:#111">(</span><span style="color:#111">sqrt</span><span style="color:#111">(</span><span style="color:#111">NX</span><span style="color:#111">));</span>
    <span style="color:#00a8c8">int</span> <span style="color:#111">sqrtNX</span> <span style="color:#f92672">=</span> <span style="color:#111">std</span><span style="color:#f92672">::</span><span style="color:#111">round</span><span style="color:#111">(</span><span style="color:#111">sqrt</span><span style="color:#111">(</span><span style="color:#111">NX</span><span style="color:#111">));</span>
    <span style="color:#00a8c8">int</span> <span style="color:#111">dims1D</span><span style="color:#111">[]</span> <span style="color:#f92672">=</span> <span style="color:#111">{(</span><span style="color:#111">NX</span><span style="color:#111">)};</span>
    <span style="color:#00a8c8">int</span> <span style="color:#111">dims2D</span><span style="color:#111">[]</span> <span style="color:#f92672">=</span> <span style="color:#111">{</span><span style="color:#111">sqrtNX</span><span style="color:#111">,</span><span style="color:#111">sqrtNX</span><span style="color:#111">};</span>

    <span style="color:#00a8c8">int</span> <span style="color:#111">rank</span> <span style="color:#f92672">=</span> <span style="color:#ae81ff">1</span><span style="color:#111">;</span>

    <span style="color:#00a8c8">int</span> <span style="color:#111">inembed</span><span style="color:#111">[]</span> <span style="color:#f92672">=</span> <span style="color:#111">{</span><span style="color:#111">NX</span><span style="color:#111">};</span> 
    <span style="color:#00a8c8">int</span> <span style="color:#111">onembed</span><span style="color:#111">[]</span> <span style="color:#f92672">=</span> <span style="color:#111">{</span><span style="color:#111">NX</span><span style="color:#111">};</span>
    <span style="color:#00a8c8">int</span> <span style="color:#111">istride</span><span style="color:#111">[]</span> <span style="color:#f92672">=</span> <span style="color:#111">{</span><span style="color:#ae81ff">1</span><span style="color:#111">,</span><span style="color:#111">sqrtNX</span><span style="color:#111">};</span> <span style="color:#75715e">// Consecutive elements, same signal 
</span><span style="color:#75715e"></span>    <span style="color:#00a8c8">int</span> <span style="color:#111">ostride</span><span style="color:#111">[]</span> <span style="color:#f92672">=</span> <span style="color:#111">{</span><span style="color:#ae81ff">1</span><span style="color:#111">,</span><span style="color:#111">sqrtNX</span><span style="color:#111">};</span> <span style="color:#75715e">//
</span><span style="color:#75715e"></span>    <span style="color:#00a8c8">int</span> <span style="color:#111">idist</span><span style="color:#111">[]</span> <span style="color:#f92672">=</span> <span style="color:#111">{</span><span style="color:#111">sqrtNX</span><span style="color:#111">,</span><span style="color:#ae81ff">1</span><span style="color:#111">};</span> <span style="color:#75715e">// Consecutive signals
</span><span style="color:#75715e"></span>    <span style="color:#00a8c8">int</span> <span style="color:#111">odist</span><span style="color:#111">[]</span> <span style="color:#f92672">=</span> <span style="color:#111">{</span><span style="color:#111">sqrtNX</span><span style="color:#111">,</span><span style="color:#ae81ff">1</span><span style="color:#111">};</span>

    <span style="color:#111">cufftHandle</span> <span style="color:#111">planMany</span><span style="color:#111">,</span> <span style="color:#111">plan1D</span><span style="color:#111">,</span> <span style="color:#111">plan2D</span><span style="color:#111">;</span>
    <span style="color:#111">cufftDoubleComplex</span> <span style="color:#f92672">*</span><span style="color:#111">data_H1DFFT</span><span style="color:#111">,</span> <span style="color:#f92672">*</span><span style="color:#111">data_H2DF1DI</span><span style="color:#111">,</span> <span style="color:#f92672">*</span><span style="color:#111">data_HmanyFFT</span><span style="color:#111">,</span> <span style="color:#f92672">*</span><span style="color:#111">data_H0</span><span style="color:#111">,</span> <span style="color:#f92672">*</span><span style="color:#111">data_D</span><span style="color:#111">;</span>

    <span style="color:#111">ERR_CHECK</span><span style="color:#111">(</span> <span style="color:#111">cudaMalloc</span><span style="color:#111">(</span> <span style="color:#111">(</span><span style="color:#111">cufftDoubleComplex</span><span style="color:#f92672">**</span><span style="color:#111">)</span> <span style="color:#f92672">&amp;</span><span style="color:#111">data_D</span><span style="color:#111">,</span> <span style="color:#00a8c8">sizeof</span><span style="color:#111">(</span><span style="color:#111">cufftDoubleComplex</span><span style="color:#111">)</span><span style="color:#f92672">*</span><span style="color:#111">NX</span><span style="color:#111">)</span> <span style="color:#111">);</span>
    <span style="color:#111">data_H1DFFT</span> <span style="color:#f92672">=</span> <span style="color:#111">(</span><span style="color:#111">cufftDoubleComplex</span><span style="color:#f92672">*</span><span style="color:#111">)</span> <span style="color:#111">malloc</span><span style="color:#111">(</span><span style="color:#00a8c8">sizeof</span><span style="color:#111">(</span><span style="color:#111">cufftDoubleComplex</span><span style="color:#111">)</span><span style="color:#f92672">*</span><span style="color:#111">NX</span><span style="color:#111">);</span>
    <span style="color:#111">data_H2DF1DI</span> <span style="color:#f92672">=</span> <span style="color:#111">(</span><span style="color:#111">cufftDoubleComplex</span><span style="color:#f92672">*</span><span style="color:#111">)</span> <span style="color:#111">malloc</span><span style="color:#111">(</span><span style="color:#00a8c8">sizeof</span><span style="color:#111">(</span><span style="color:#111">cufftDoubleComplex</span><span style="color:#111">)</span><span style="color:#f92672">*</span><span style="color:#111">NX</span><span style="color:#111">);</span>
    <span style="color:#111">data_HmanyFFT</span> <span style="color:#f92672">=</span> <span style="color:#111">(</span><span style="color:#111">cufftDoubleComplex</span><span style="color:#f92672">*</span><span style="color:#111">)</span> <span style="color:#111">malloc</span><span style="color:#111">(</span><span style="color:#00a8c8">sizeof</span><span style="color:#111">(</span><span style="color:#111">cufftDoubleComplex</span><span style="color:#111">)</span><span style="color:#f92672">*</span><span style="color:#111">NX</span><span style="color:#111">);</span>
    <span style="color:#111">data_H0</span> <span style="color:#f92672">=</span> <span style="color:#111">(</span><span style="color:#111">cufftDoubleComplex</span><span style="color:#f92672">*</span><span style="color:#111">)</span> <span style="color:#111">malloc</span><span style="color:#111">(</span><span style="color:#00a8c8">sizeof</span><span style="color:#111">(</span><span style="color:#111">cufftDoubleComplex</span><span style="color:#111">)</span><span style="color:#f92672">*</span><span style="color:#111">NX</span><span style="color:#111">);</span>

    <span style="color:#75715e">// ********************************************************* //
</span><span style="color:#75715e"></span>    <span style="color:#75715e">// Create the input data
</span><span style="color:#75715e"></span>    <span style="color:#75715e">// ********************************************************* //
</span><span style="color:#75715e"></span>    <span style="color:#111">std</span><span style="color:#f92672">::</span><span style="color:#111">cout</span> <span style="color:#f92672">&lt;&lt;</span> <span style="color:#d88200">&#34;INPUT:</span><span style="color:#8045ff">\n</span><span style="color:#d88200">&#34;</span><span style="color:#111">;</span>
    <span style="color:#00a8c8">for</span><span style="color:#111">(</span><span style="color:#00a8c8">int</span> <span style="color:#111">ii</span><span style="color:#f92672">=</span><span style="color:#ae81ff">0</span><span style="color:#111">;</span> <span style="color:#111">ii</span><span style="color:#f92672">&lt;</span><span style="color:#111">sqrtNX</span><span style="color:#111">;</span> <span style="color:#f92672">++</span><span style="color:#111">ii</span><span style="color:#111">){</span>
        <span style="color:#00a8c8">for</span><span style="color:#111">(</span><span style="color:#00a8c8">int</span> <span style="color:#111">jj</span><span style="color:#f92672">=</span><span style="color:#ae81ff">0</span><span style="color:#111">;</span> <span style="color:#111">jj</span><span style="color:#f92672">&lt;</span><span style="color:#111">sqrtNX</span><span style="color:#111">;</span> <span style="color:#f92672">++</span><span style="color:#111">jj</span><span style="color:#111">){</span>
            <span style="color:#111">data_H0</span><span style="color:#111">[</span><span style="color:#111">jj</span> <span style="color:#f92672">+</span> <span style="color:#111">ii</span><span style="color:#f92672">*</span><span style="color:#111">sqrtNX</span><span style="color:#111">].</span><span style="color:#111">x</span> <span style="color:#f92672">=</span> <span style="color:#111">(</span><span style="color:#00a8c8">double</span><span style="color:#111">)</span> <span style="color:#111">ii</span><span style="color:#111">;</span>
            <span style="color:#111">data_H0</span><span style="color:#111">[</span><span style="color:#111">jj</span> <span style="color:#f92672">+</span> <span style="color:#111">ii</span><span style="color:#f92672">*</span><span style="color:#111">sqrtNX</span><span style="color:#111">].</span><span style="color:#111">y</span> <span style="color:#f92672">=</span> <span style="color:#111">(</span><span style="color:#00a8c8">double</span><span style="color:#111">)</span> <span style="color:#111">jj</span><span style="color:#111">;</span>
            <span style="color:#111">std</span><span style="color:#f92672">::</span><span style="color:#111">cout</span> <span style="color:#f92672">&lt;&lt;</span> <span style="color:#111">data_H0</span><span style="color:#111">[</span><span style="color:#111">jj</span> <span style="color:#f92672">+</span> <span style="color:#111">ii</span><span style="color:#f92672">*</span><span style="color:#111">sqrtNX</span><span style="color:#111">].</span><span style="color:#111">x</span> <span style="color:#f92672">&lt;&lt;</span> <span style="color:#d88200">&#34; + 1i*&#34;</span> <span style="color:#f92672">&lt;&lt;</span> <span style="color:#111">data_H0</span><span style="color:#111">[</span><span style="color:#111">jj</span> <span style="color:#f92672">+</span> <span style="color:#111">ii</span><span style="color:#f92672">*</span><span style="color:#111">sqrtNX</span><span style="color:#111">].</span><span style="color:#111">y</span> <span style="color:#f92672">&lt;&lt;</span> <span style="color:#d88200">&#34;</span><span style="color:#8045ff">\t</span><span style="color:#d88200">&#34;</span><span style="color:#111">;</span>
        <span style="color:#111">}</span>
        <span style="color:#111">std</span><span style="color:#f92672">::</span><span style="color:#111">cout</span> <span style="color:#f92672">&lt;&lt;</span> <span style="color:#d88200">&#34;</span><span style="color:#8045ff">\n</span><span style="color:#d88200">&#34;</span><span style="color:#111">;</span>
    <span style="color:#111">}</span>
    <span style="color:#111">std</span><span style="color:#f92672">::</span><span style="color:#111">cout</span> <span style="color:#f92672">&lt;&lt;</span> <span style="color:#d88200">&#34;</span><span style="color:#8045ff">\n</span><span style="color:#d88200">&#34;</span><span style="color:#111">;</span>

    <span style="color:#111">ERR_CHECK</span><span style="color:#111">(</span> <span style="color:#111">cudaMemcpy</span><span style="color:#111">(</span><span style="color:#111">data_D</span><span style="color:#111">,</span> <span style="color:#111">data_H0</span><span style="color:#111">,</span> <span style="color:#00a8c8">sizeof</span><span style="color:#111">(</span><span style="color:#111">cufftDoubleComplex</span><span style="color:#111">)</span> <span style="color:#f92672">*</span> <span style="color:#111">NX</span><span style="color:#111">,</span> <span style="color:#111">cudaMemcpyHostToDevice</span><span style="color:#111">));</span>

    <span style="color:#75715e">// ******************************************************************************** //
</span><span style="color:#75715e"></span>    <span style="color:#75715e">// First, check the 1D FFT along the standard dimension
</span><span style="color:#75715e"></span>    <span style="color:#75715e">// ******************************************************************************** //
</span><span style="color:#75715e"></span>    <span style="color:#111">FFT_ERR_CHECK</span><span style="color:#111">(</span><span style="color:#111">cufftPlan1d</span><span style="color:#111">(</span><span style="color:#f92672">&amp;</span><span style="color:#111">plan1D</span><span style="color:#111">,</span> <span style="color:#111">dims2D</span><span style="color:#111">[</span><span style="color:#ae81ff">0</span><span style="color:#111">],</span> <span style="color:#111">CUFFT_Z2Z</span><span style="color:#111">,</span> <span style="color:#111">numTransform</span><span style="color:#111">));</span>
    <span style="color:#111">FFT_ERR_CHECK</span><span style="color:#111">(</span><span style="color:#111">cufftExecZ2Z</span><span style="color:#111">(</span><span style="color:#111">plan1D</span><span style="color:#111">,</span> <span style="color:#111">data_D</span><span style="color:#111">,</span> <span style="color:#111">data_D</span><span style="color:#111">,</span> <span style="color:#111">CUFFT_FORWARD</span><span style="color:#111">));</span>
    <span style="color:#111">ERR_CHECK</span><span style="color:#111">(</span><span style="color:#111">cudaMemcpy</span><span style="color:#111">(</span><span style="color:#111">data_H1DFFT</span><span style="color:#111">,</span> <span style="color:#111">data_D</span><span style="color:#111">,</span> <span style="color:#00a8c8">sizeof</span><span style="color:#111">(</span><span style="color:#111">cufftDoubleComplex</span><span style="color:#111">)</span> <span style="color:#f92672">*</span> <span style="color:#111">NX</span><span style="color:#111">,</span> <span style="color:#111">cudaMemcpyDeviceToHost</span><span style="color:#111">));</span>
    <span style="color:#111">std</span><span style="color:#f92672">::</span><span style="color:#111">cout</span> <span style="color:#f92672">&lt;&lt;</span> <span style="color:#d88200">&#34;OUTPUT 1D:</span><span style="color:#8045ff">\n</span><span style="color:#d88200">&#34;</span><span style="color:#111">;</span>
    <span style="color:#00a8c8">for</span><span style="color:#111">(</span><span style="color:#00a8c8">int</span> <span style="color:#111">ii</span><span style="color:#f92672">=</span><span style="color:#ae81ff">0</span><span style="color:#111">;</span> <span style="color:#111">ii</span><span style="color:#f92672">&lt;</span><span style="color:#111">sqrtNX</span><span style="color:#111">;</span> <span style="color:#f92672">++</span><span style="color:#111">ii</span><span style="color:#111">){</span>
        <span style="color:#00a8c8">for</span><span style="color:#111">(</span><span style="color:#00a8c8">int</span> <span style="color:#111">jj</span><span style="color:#f92672">=</span><span style="color:#ae81ff">0</span><span style="color:#111">;</span> <span style="color:#111">jj</span><span style="color:#f92672">&lt;</span><span style="color:#111">sqrtNX</span><span style="color:#111">;</span> <span style="color:#f92672">++</span><span style="color:#111">jj</span><span style="color:#111">){</span>
            <span style="color:#111">std</span><span style="color:#f92672">::</span><span style="color:#111">cout</span> <span style="color:#f92672">&lt;&lt;</span> <span style="color:#111">data_H1DFFT</span><span style="color:#111">[</span><span style="color:#111">jj</span> <span style="color:#f92672">+</span> <span style="color:#111">ii</span><span style="color:#f92672">*</span><span style="color:#111">sqrtNX</span><span style="color:#111">].</span><span style="color:#111">x</span> <span style="color:#f92672">&lt;&lt;</span> <span style="color:#d88200">&#34; + 1i*&#34;</span> <span style="color:#f92672">&lt;&lt;</span> <span style="color:#111">data_H1DFFT</span><span style="color:#111">[</span><span style="color:#111">jj</span> <span style="color:#f92672">+</span> <span style="color:#111">ii</span><span style="color:#f92672">*</span><span style="color:#111">sqrtNX</span><span style="color:#111">].</span><span style="color:#111">y</span> <span style="color:#f92672">&lt;&lt;</span> <span style="color:#d88200">&#34;</span><span style="color:#8045ff">\t</span><span style="color:#d88200">&#34;</span><span style="color:#111">;</span>
        <span style="color:#111">}</span>
        <span style="color:#111">std</span><span style="color:#f92672">::</span><span style="color:#111">cout</span> <span style="color:#f92672">&lt;&lt;</span> <span style="color:#d88200">&#34;</span><span style="color:#8045ff">\n</span><span style="color:#d88200">&#34;</span><span style="color:#111">;</span>
    <span style="color:#111">}</span>

    <span style="color:#75715e">//Overwrite GPU data to original values
</span><span style="color:#75715e"></span>    <span style="color:#111">ERR_CHECK</span><span style="color:#111">(</span> <span style="color:#111">cudaMemcpy</span><span style="color:#111">(</span><span style="color:#111">data_D</span><span style="color:#111">,</span> <span style="color:#111">data_H0</span><span style="color:#111">,</span> <span style="color:#00a8c8">sizeof</span><span style="color:#111">(</span><span style="color:#111">cufftDoubleComplex</span><span style="color:#111">)</span> <span style="color:#f92672">*</span> <span style="color:#111">NX</span><span style="color:#111">,</span> <span style="color:#111">cudaMemcpyHostToDevice</span><span style="color:#111">));</span>

    <span style="color:#75715e">// ******************************************************************************** //
</span><span style="color:#75715e"></span>    <span style="color:#75715e">// ******************************************************************************** //
</span><span style="color:#75715e"></span>    <span style="color:#75715e">// Next, check the Many FFT along the same expected dimension
</span><span style="color:#75715e"></span>    <span style="color:#75715e">// ******************************************************************************** //
</span><span style="color:#75715e"></span>
    <span style="color:#111">FFT_ERR_CHECK</span><span style="color:#111">(</span><span style="color:#111">cufftPlanMany</span><span style="color:#111">(</span><span style="color:#f92672">&amp;</span><span style="color:#111">planMany</span><span style="color:#111">,</span> <span style="color:#111">rank</span><span style="color:#111">,</span> <span style="color:#111">dims2D</span><span style="color:#111">,</span> <span style="color:#111">inembed</span><span style="color:#111">,</span> <span style="color:#111">istride</span><span style="color:#111">[</span><span style="color:#ae81ff">0</span><span style="color:#111">],</span> <span style="color:#111">idist</span><span style="color:#111">[</span><span style="color:#ae81ff">0</span><span style="color:#111">],</span> <span style="color:#111">onembed</span><span style="color:#111">,</span> <span style="color:#111">ostride</span><span style="color:#111">[</span><span style="color:#ae81ff">0</span><span style="color:#111">],</span> <span style="color:#111">odist</span><span style="color:#111">[</span><span style="color:#ae81ff">0</span><span style="color:#111">],</span> <span style="color:#111">CUFFT_Z2Z</span><span style="color:#111">,</span> <span style="color:#111">numTransform</span><span style="color:#111">));</span>
    <span style="color:#111">FFT_ERR_CHECK</span><span style="color:#111">(</span><span style="color:#111">cufftExecZ2Z</span><span style="color:#111">(</span><span style="color:#111">planMany</span><span style="color:#111">,</span> <span style="color:#111">data_D</span><span style="color:#111">,</span> <span style="color:#111">data_D</span><span style="color:#111">,</span> <span style="color:#111">CUFFT_FORWARD</span><span style="color:#111">));</span>

    <span style="color:#111">ERR_CHECK</span><span style="color:#111">(</span><span style="color:#111">cudaMemcpy</span><span style="color:#111">(</span><span style="color:#111">data_HmanyFFT</span><span style="color:#111">,</span> <span style="color:#111">data_D</span><span style="color:#111">,</span> <span style="color:#00a8c8">sizeof</span><span style="color:#111">(</span><span style="color:#111">cufftDoubleComplex</span><span style="color:#111">)</span> <span style="color:#f92672">*</span> <span style="color:#111">NX</span><span style="color:#111">,</span> <span style="color:#111">cudaMemcpyDeviceToHost</span><span style="color:#111">));</span>

    <span style="color:#111">std</span><span style="color:#f92672">::</span><span style="color:#111">cout</span> <span style="color:#f92672">&lt;&lt;</span> <span style="color:#d88200">&#34;OUTPUT MANY 1D:</span><span style="color:#8045ff">\n</span><span style="color:#d88200">&#34;</span><span style="color:#111">;</span>
    <span style="color:#00a8c8">for</span><span style="color:#111">(</span><span style="color:#00a8c8">int</span> <span style="color:#111">ii</span><span style="color:#f92672">=</span><span style="color:#ae81ff">0</span><span style="color:#111">;</span> <span style="color:#111">ii</span><span style="color:#f92672">&lt;</span><span style="color:#111">sqrtNX</span><span style="color:#111">;</span> <span style="color:#f92672">++</span><span style="color:#111">ii</span><span style="color:#111">){</span>
        <span style="color:#00a8c8">for</span><span style="color:#111">(</span><span style="color:#00a8c8">int</span> <span style="color:#111">jj</span><span style="color:#f92672">=</span><span style="color:#ae81ff">0</span><span style="color:#111">;</span> <span style="color:#111">jj</span><span style="color:#f92672">&lt;</span><span style="color:#111">sqrtNX</span><span style="color:#111">;</span> <span style="color:#f92672">++</span><span style="color:#111">jj</span><span style="color:#111">){</span>
            <span style="color:#111">std</span><span style="color:#f92672">::</span><span style="color:#111">cout</span> <span style="color:#f92672">&lt;&lt;</span> <span style="color:#111">data_HmanyFFT</span><span style="color:#111">[</span><span style="color:#111">jj</span> <span style="color:#f92672">+</span> <span style="color:#111">ii</span><span style="color:#f92672">*</span><span style="color:#111">sqrtNX</span><span style="color:#111">].</span><span style="color:#111">x</span> <span style="color:#f92672">&lt;&lt;</span> <span style="color:#d88200">&#34; + 1i*&#34;</span> <span style="color:#f92672">&lt;&lt;</span> <span style="color:#111">data_HmanyFFT</span><span style="color:#111">[</span><span style="color:#111">jj</span> <span style="color:#f92672">+</span> <span style="color:#111">ii</span><span style="color:#f92672">*</span><span style="color:#111">sqrtNX</span><span style="color:#111">].</span><span style="color:#111">y</span> <span style="color:#f92672">&lt;&lt;</span> <span style="color:#d88200">&#34;</span><span style="color:#8045ff">\t</span><span style="color:#d88200">&#34;</span><span style="color:#111">;</span>
        <span style="color:#111">}</span>
        <span style="color:#111">std</span><span style="color:#f92672">::</span><span style="color:#111">cout</span> <span style="color:#f92672">&lt;&lt;</span> <span style="color:#d88200">&#34;</span><span style="color:#8045ff">\n</span><span style="color:#d88200">&#34;</span><span style="color:#111">;</span>
    <span style="color:#111">}</span>

    <span style="color:#00a8c8">try</span> <span style="color:#111">{</span>
        <span style="color:#00a8c8">for</span> <span style="color:#111">(</span><span style="color:#00a8c8">int</span> <span style="color:#111">ii</span><span style="color:#f92672">=</span><span style="color:#ae81ff">0</span><span style="color:#111">;</span> <span style="color:#111">ii</span><span style="color:#f92672">&lt;</span><span style="color:#111">NX</span><span style="color:#111">;</span> <span style="color:#f92672">++</span><span style="color:#111">ii</span><span style="color:#111">){</span>
            <span style="color:#111">assert</span><span style="color:#111">(</span> <span style="color:#111">(</span><span style="color:#111">data_H1DFFT</span><span style="color:#111">[</span><span style="color:#111">ii</span><span style="color:#111">].</span><span style="color:#111">x</span> <span style="color:#f92672">-</span> <span style="color:#111">data_HmanyFFT</span><span style="color:#111">[</span><span style="color:#111">ii</span><span style="color:#111">].</span><span style="color:#111">x</span><span style="color:#111">)</span> <span style="color:#f92672">&lt;</span> <span style="color:#ae81ff">1e-7</span>  <span style="color:#111">);</span>
            <span style="color:#111">assert</span><span style="color:#111">(</span> <span style="color:#111">(</span><span style="color:#111">data_H1DFFT</span><span style="color:#111">[</span><span style="color:#111">ii</span><span style="color:#111">].</span><span style="color:#111">y</span> <span style="color:#f92672">-</span> <span style="color:#111">data_HmanyFFT</span><span style="color:#111">[</span><span style="color:#111">ii</span><span style="color:#111">].</span><span style="color:#111">y</span><span style="color:#111">)</span> <span style="color:#f92672">&lt;</span> <span style="color:#ae81ff">1e-7</span>  <span style="color:#111">);</span>
        <span style="color:#111">}</span>
    <span style="color:#111">}</span> <span style="color:#00a8c8">catch</span> <span style="color:#111">(</span><span style="color:#00a8c8">const</span> <span style="color:#00a8c8">char</span><span style="color:#f92672">*</span> <span style="color:#111">msg</span><span style="color:#111">)</span> <span style="color:#111">{</span>
        <span style="color:#111">std</span><span style="color:#f92672">::</span><span style="color:#111">cerr</span> <span style="color:#f92672">&lt;&lt;</span> <span style="color:#111">msg</span> <span style="color:#f92672">&lt;&lt;</span> <span style="color:#111">std</span><span style="color:#f92672">::</span><span style="color:#111">endl</span><span style="color:#111">;</span>
    <span style="color:#111">}</span>
    <span style="color:#75715e">//Overwrite GPU data to original values
</span><span style="color:#75715e"></span>    <span style="color:#111">ERR_CHECK</span><span style="color:#111">(</span> <span style="color:#111">cudaMemcpy</span><span style="color:#111">(</span><span style="color:#111">data_D</span><span style="color:#111">,</span> <span style="color:#111">data_H0</span><span style="color:#111">,</span> <span style="color:#00a8c8">sizeof</span><span style="color:#111">(</span><span style="color:#111">cufftDoubleComplex</span><span style="color:#111">)</span> <span style="color:#f92672">*</span> <span style="color:#111">NX</span><span style="color:#111">,</span> <span style="color:#111">cudaMemcpyHostToDevice</span><span style="color:#111">));</span>

    <span style="color:#75715e">// ******************************************************************************** //
</span><span style="color:#75715e"></span>    <span style="color:#75715e">// Check the 2D FFT Forward, 1D FFT back
</span><span style="color:#75715e"></span>    <span style="color:#75715e">// ******************************************************************************** //
</span><span style="color:#75715e"></span>    <span style="color:#111">FFT_ERR_CHECK</span><span style="color:#111">(</span><span style="color:#111">cufftPlan2d</span><span style="color:#111">(</span><span style="color:#f92672">&amp;</span><span style="color:#111">plan2D</span><span style="color:#111">,</span> <span style="color:#111">dims2D</span><span style="color:#111">[</span><span style="color:#ae81ff">0</span><span style="color:#111">],</span> <span style="color:#111">dims2D</span><span style="color:#111">[</span><span style="color:#ae81ff">1</span><span style="color:#111">],</span> <span style="color:#111">CUFFT_Z2Z</span><span style="color:#111">));</span>
    <span style="color:#111">FFT_ERR_CHECK</span><span style="color:#111">(</span><span style="color:#111">cufftExecZ2Z</span><span style="color:#111">(</span><span style="color:#111">plan2D</span><span style="color:#111">,</span> <span style="color:#111">data_D</span><span style="color:#111">,</span> <span style="color:#111">data_D</span><span style="color:#111">,</span> <span style="color:#111">CUFFT_FORWARD</span><span style="color:#111">));</span>
    <span style="color:#111">FFT_ERR_CHECK</span><span style="color:#111">(</span><span style="color:#111">cufftExecZ2Z</span><span style="color:#111">(</span><span style="color:#111">plan1D</span><span style="color:#111">,</span> <span style="color:#111">data_D</span><span style="color:#111">,</span> <span style="color:#111">data_D</span><span style="color:#111">,</span> <span style="color:#111">CUFFT_INVERSE</span><span style="color:#111">));</span>

    <span style="color:#111">ERR_CHECK</span><span style="color:#111">(</span><span style="color:#111">cudaMemcpy</span><span style="color:#111">(</span><span style="color:#111">data_H2DF1DI</span><span style="color:#111">,</span> <span style="color:#111">data_D</span><span style="color:#111">,</span> <span style="color:#00a8c8">sizeof</span><span style="color:#111">(</span><span style="color:#111">cufftDoubleComplex</span><span style="color:#111">)</span> <span style="color:#f92672">*</span> <span style="color:#111">NX</span><span style="color:#111">,</span> <span style="color:#111">cudaMemcpyDeviceToHost</span><span style="color:#111">));</span>
    <span style="color:#111">std</span><span style="color:#f92672">::</span><span style="color:#111">cout</span> <span style="color:#f92672">&lt;&lt;</span> <span style="color:#d88200">&#34;OUTPUT 2DF-1DI:</span><span style="color:#8045ff">\n</span><span style="color:#d88200">&#34;</span><span style="color:#111">;</span>
    <span style="color:#00a8c8">for</span><span style="color:#111">(</span><span style="color:#00a8c8">int</span> <span style="color:#111">ii</span><span style="color:#f92672">=</span><span style="color:#ae81ff">0</span><span style="color:#111">;</span> <span style="color:#111">ii</span><span style="color:#f92672">&lt;</span><span style="color:#111">sqrtNX</span><span style="color:#111">;</span> <span style="color:#f92672">++</span><span style="color:#111">ii</span><span style="color:#111">){</span>
        <span style="color:#00a8c8">for</span><span style="color:#111">(</span><span style="color:#00a8c8">int</span> <span style="color:#111">jj</span><span style="color:#f92672">=</span><span style="color:#ae81ff">0</span><span style="color:#111">;</span> <span style="color:#111">jj</span><span style="color:#f92672">&lt;</span><span style="color:#111">sqrtNX</span><span style="color:#111">;</span> <span style="color:#f92672">++</span><span style="color:#111">jj</span><span style="color:#111">){</span>
            <span style="color:#111">std</span><span style="color:#f92672">::</span><span style="color:#111">cout</span> <span style="color:#f92672">&lt;&lt;</span> <span style="color:#111">data_H2DF1DI</span><span style="color:#111">[</span><span style="color:#111">jj</span> <span style="color:#f92672">+</span> <span style="color:#111">ii</span><span style="color:#f92672">*</span><span style="color:#111">sqrtNX</span><span style="color:#111">].</span><span style="color:#111">x</span><span style="color:#f92672">/</span><span style="color:#111">sqrtNX</span> <span style="color:#f92672">&lt;&lt;</span> <span style="color:#d88200">&#34; + 1i*&#34;</span> <span style="color:#f92672">&lt;&lt;</span> <span style="color:#111">data_H2DF1DI</span><span style="color:#111">[</span><span style="color:#111">jj</span> <span style="color:#f92672">+</span> <span style="color:#111">ii</span><span style="color:#f92672">*</span><span style="color:#111">sqrtNX</span><span style="color:#111">].</span><span style="color:#111">y</span><span style="color:#f92672">/</span><span style="color:#111">sqrtNX</span> <span style="color:#f92672">&lt;&lt;</span> <span style="color:#d88200">&#34;</span><span style="color:#8045ff">\t</span><span style="color:#d88200">&#34;</span><span style="color:#111">;</span>
        <span style="color:#111">}</span>
        <span style="color:#111">std</span><span style="color:#f92672">::</span><span style="color:#111">cout</span> <span style="color:#f92672">&lt;&lt;</span> <span style="color:#d88200">&#34;</span><span style="color:#8045ff">\n</span><span style="color:#d88200">&#34;</span><span style="color:#111">;</span>
    <span style="color:#111">}</span>
    <span style="color:#75715e">//Overwrite GPU data to original values
</span><span style="color:#75715e"></span>    <span style="color:#111">ERR_CHECK</span><span style="color:#111">(</span> <span style="color:#111">cudaMemcpy</span><span style="color:#111">(</span><span style="color:#111">data_D</span><span style="color:#111">,</span> <span style="color:#111">data_H0</span><span style="color:#111">,</span> <span style="color:#00a8c8">sizeof</span><span style="color:#111">(</span><span style="color:#111">cufftDoubleComplex</span><span style="color:#111">)</span> <span style="color:#f92672">*</span> <span style="color:#111">NX</span><span style="color:#111">,</span> <span style="color:#111">cudaMemcpyHostToDevice</span><span style="color:#111">));</span>

    <span style="color:#75715e">// ******************************************************************************** //
</span><span style="color:#75715e"></span>    <span style="color:#75715e">// ******************************************************************************** //
</span><span style="color:#75715e"></span>    <span style="color:#75715e">// Lastly, check the Many FFT along the other dimension
</span><span style="color:#75715e"></span>    <span style="color:#75715e">// ******************************************************************************** //
</span><span style="color:#75715e"></span>
    <span style="color:#111">FFT_ERR_CHECK</span><span style="color:#111">(</span><span style="color:#111">cufftPlanMany</span><span style="color:#111">(</span><span style="color:#f92672">&amp;</span><span style="color:#111">planMany</span><span style="color:#111">,</span> <span style="color:#111">rank</span><span style="color:#111">,</span> <span style="color:#111">dims2D</span><span style="color:#111">,</span> <span style="color:#111">inembed</span><span style="color:#111">,</span> <span style="color:#111">istride</span><span style="color:#111">[</span><span style="color:#ae81ff">1</span><span style="color:#111">],</span> <span style="color:#111">idist</span><span style="color:#111">[</span><span style="color:#ae81ff">1</span><span style="color:#111">],</span> <span style="color:#111">onembed</span><span style="color:#111">,</span> <span style="color:#111">ostride</span><span style="color:#111">[</span><span style="color:#ae81ff">1</span><span style="color:#111">],</span> <span style="color:#111">odist</span><span style="color:#111">[</span><span style="color:#ae81ff">1</span><span style="color:#111">],</span> <span style="color:#111">CUFFT_Z2Z</span><span style="color:#111">,</span> <span style="color:#111">sqrtNX</span><span style="color:#111">));</span>
    <span style="color:#111">FFT_ERR_CHECK</span><span style="color:#111">(</span><span style="color:#111">cufftExecZ2Z</span><span style="color:#111">(</span><span style="color:#111">planMany</span><span style="color:#111">,</span> <span style="color:#111">data_D</span><span style="color:#111">,</span> <span style="color:#111">data_D</span><span style="color:#111">,</span> <span style="color:#111">CUFFT_FORWARD</span><span style="color:#111">));</span>

    <span style="color:#75715e">//ERR_CHECK(cudaDeviceSynchronize());
</span><span style="color:#75715e"></span>    <span style="color:#111">ERR_CHECK</span><span style="color:#111">(</span><span style="color:#111">cudaMemcpy</span><span style="color:#111">(</span><span style="color:#111">data_HmanyFFT</span><span style="color:#111">,</span> <span style="color:#111">data_D</span><span style="color:#111">,</span> <span style="color:#00a8c8">sizeof</span><span style="color:#111">(</span><span style="color:#111">cufftDoubleComplex</span><span style="color:#111">)</span> <span style="color:#f92672">*</span> <span style="color:#111">NX</span><span style="color:#111">,</span> <span style="color:#111">cudaMemcpyDeviceToHost</span><span style="color:#111">));</span>

    <span style="color:#111">std</span><span style="color:#f92672">::</span><span style="color:#111">cout</span> <span style="color:#f92672">&lt;&lt;</span> <span style="color:#d88200">&#34;OUTPUT MANY 1D Other:</span><span style="color:#8045ff">\n</span><span style="color:#d88200">&#34;</span><span style="color:#111">;</span>
    <span style="color:#00a8c8">for</span><span style="color:#111">(</span><span style="color:#00a8c8">int</span> <span style="color:#111">ii</span><span style="color:#f92672">=</span><span style="color:#ae81ff">0</span><span style="color:#111">;</span> <span style="color:#111">ii</span><span style="color:#f92672">&lt;</span><span style="color:#111">sqrtNX</span><span style="color:#111">;</span> <span style="color:#f92672">++</span><span style="color:#111">ii</span><span style="color:#111">){</span>
        <span style="color:#00a8c8">for</span><span style="color:#111">(</span><span style="color:#00a8c8">int</span> <span style="color:#111">jj</span><span style="color:#f92672">=</span><span style="color:#ae81ff">0</span><span style="color:#111">;</span> <span style="color:#111">jj</span><span style="color:#f92672">&lt;</span><span style="color:#111">sqrtNX</span><span style="color:#111">;</span> <span style="color:#f92672">++</span><span style="color:#111">jj</span><span style="color:#111">){</span>
            <span style="color:#111">std</span><span style="color:#f92672">::</span><span style="color:#111">cout</span> <span style="color:#f92672">&lt;&lt;</span> <span style="color:#111">data_HmanyFFT</span><span style="color:#111">[</span><span style="color:#111">jj</span> <span style="color:#f92672">+</span> <span style="color:#111">ii</span><span style="color:#f92672">*</span><span style="color:#111">sqrtNX</span><span style="color:#111">].</span><span style="color:#111">x</span> <span style="color:#f92672">&lt;&lt;</span> <span style="color:#d88200">&#34; + 1i*&#34;</span> <span style="color:#f92672">&lt;&lt;</span> <span style="color:#111">data_HmanyFFT</span><span style="color:#111">[</span><span style="color:#111">jj</span> <span style="color:#f92672">+</span> <span style="color:#111">ii</span><span style="color:#f92672">*</span><span style="color:#111">sqrtNX</span><span style="color:#111">].</span><span style="color:#111">y</span> <span style="color:#f92672">&lt;&lt;</span> <span style="color:#d88200">&#34;</span><span style="color:#8045ff">\t</span><span style="color:#d88200">&#34;</span><span style="color:#111">;</span>
        <span style="color:#111">}</span>
        <span style="color:#111">std</span><span style="color:#f92672">::</span><span style="color:#111">cout</span> <span style="color:#f92672">&lt;&lt;</span> <span style="color:#d88200">&#34;</span><span style="color:#8045ff">\n</span><span style="color:#d88200">&#34;</span><span style="color:#111">;</span>
    <span style="color:#111">}</span>
    <span style="color:#00a8c8">try</span> <span style="color:#111">{</span>
        <span style="color:#00a8c8">for</span> <span style="color:#111">(</span><span style="color:#00a8c8">int</span> <span style="color:#111">ii</span><span style="color:#f92672">=</span><span style="color:#ae81ff">0</span><span style="color:#111">;</span> <span style="color:#111">ii</span><span style="color:#f92672">&lt;</span><span style="color:#111">NX</span><span style="color:#111">;</span> <span style="color:#f92672">++</span><span style="color:#111">ii</span><span style="color:#111">){</span>
            <span style="color:#75715e">//std::cout &lt;&lt; ( (data_H2DF1DI[ii].x/sqrtNX - data_HmanyFFT[ii].x) &lt; 1e-7  ) &lt;&lt; &#34;\n&#34;;
</span><span style="color:#75715e"></span>            <span style="color:#111">assert</span><span style="color:#111">(</span> <span style="color:#111">(</span><span style="color:#111">data_H2DF1DI</span><span style="color:#111">[</span><span style="color:#111">ii</span><span style="color:#111">].</span><span style="color:#111">x</span><span style="color:#f92672">/</span><span style="color:#111">sqrtNX</span> <span style="color:#f92672">-</span> <span style="color:#111">data_HmanyFFT</span><span style="color:#111">[</span><span style="color:#111">ii</span><span style="color:#111">].</span><span style="color:#111">x</span><span style="color:#111">)</span>  <span style="color:#f92672">&lt;</span> <span style="color:#ae81ff">1e-7</span> <span style="color:#111">);</span>
            <span style="color:#111">assert</span><span style="color:#111">(</span> <span style="color:#111">(</span><span style="color:#111">data_H2DF1DI</span><span style="color:#111">[</span><span style="color:#111">ii</span><span style="color:#111">].</span><span style="color:#111">y</span><span style="color:#f92672">/</span><span style="color:#111">sqrtNX</span> <span style="color:#f92672">-</span> <span style="color:#111">data_HmanyFFT</span><span style="color:#111">[</span><span style="color:#111">ii</span><span style="color:#111">].</span><span style="color:#111">y</span><span style="color:#111">)</span>  <span style="color:#f92672">&lt;</span> <span style="color:#ae81ff">1e-7</span> <span style="color:#111">);</span>
        <span style="color:#111">}</span>
    <span style="color:#111">}</span> <span style="color:#00a8c8">catch</span> <span style="color:#111">(</span><span style="color:#00a8c8">const</span> <span style="color:#00a8c8">char</span><span style="color:#f92672">*</span> <span style="color:#111">msg</span><span style="color:#111">)</span> <span style="color:#111">{</span>
        <span style="color:#111">std</span><span style="color:#f92672">::</span><span style="color:#111">cerr</span> <span style="color:#f92672">&lt;&lt;</span> <span style="color:#111">msg</span> <span style="color:#f92672">&lt;&lt;</span> <span style="color:#111">std</span><span style="color:#f92672">::</span><span style="color:#111">endl</span><span style="color:#111">;</span>
    <span style="color:#111">}</span>

    <span style="color:#75715e">//Overwrite GPU data to original values
</span><span style="color:#75715e"></span>    <span style="color:#111">ERR_CHECK</span><span style="color:#111">(</span> <span style="color:#111">cudaMemcpy</span><span style="color:#111">(</span><span style="color:#111">data_D</span><span style="color:#111">,</span> <span style="color:#111">data_H0</span><span style="color:#111">,</span> <span style="color:#00a8c8">sizeof</span><span style="color:#111">(</span><span style="color:#111">cufftDoubleComplex</span><span style="color:#111">)</span> <span style="color:#f92672">*</span> <span style="color:#111">NX</span><span style="color:#111">,</span> <span style="color:#111">cudaMemcpyHostToDevice</span><span style="color:#111">));</span>

    <span style="color:#75715e">// ******************************************************************************** //
</span><span style="color:#75715e"></span>    <span style="color:#75715e">// ******************************************************************************** //
</span><span style="color:#75715e"></span>    <span style="color:#75715e">// Free stuff
</span><span style="color:#75715e"></span>    <span style="color:#75715e">// ******************************************************************************** //
</span><span style="color:#75715e"></span>
    <span style="color:#111">cufftDestroy</span><span style="color:#111">(</span><span style="color:#111">planMany</span><span style="color:#111">);</span><span style="color:#111">cufftDestroy</span><span style="color:#111">(</span><span style="color:#111">plan1D</span><span style="color:#111">);</span><span style="color:#111">cufftDestroy</span><span style="color:#111">(</span><span style="color:#111">plan2D</span><span style="color:#111">);</span>
    <span style="color:#111">cudaFree</span><span style="color:#111">(</span><span style="color:#111">data_D</span><span style="color:#111">);</span>
    <span style="color:#111">free</span><span style="color:#111">(</span><span style="color:#111">data_HmanyFFT</span><span style="color:#111">);</span><span style="color:#111">free</span><span style="color:#111">(</span><span style="color:#111">data_H0</span><span style="color:#111">);</span>
    <span style="color:#111">free</span><span style="color:#111">(</span><span style="color:#111">data_H2DF1DI</span><span style="color:#111">);</span><span style="color:#111">free</span><span style="color:#111">(</span><span style="color:#111">data_H1DFFT</span><span style="color:#111">);</span>
<span style="color:#111">}</span>

<span style="color:#00a8c8">void</span> <span style="color:#75af00">fftIt3D</span><span style="color:#111">(){</span>
    <span style="color:#00a8c8">int</span> <span style="color:#111">dimLength</span> <span style="color:#f92672">=</span> <span style="color:#ae81ff">5</span><span style="color:#111">;</span>
    <span style="color:#00a8c8">int</span> <span style="color:#111">NX</span> <span style="color:#f92672">=</span> <span style="color:#111">dimLength</span><span style="color:#f92672">*</span><span style="color:#111">dimLength</span><span style="color:#f92672">*</span><span style="color:#111">dimLength</span><span style="color:#111">;</span>

    <span style="color:#00a8c8">int</span> <span style="color:#111">cbrtNX</span> <span style="color:#f92672">=</span> <span style="color:#111">std</span><span style="color:#f92672">::</span><span style="color:#111">cbrt</span><span style="color:#111">(</span><span style="color:#111">NX</span><span style="color:#111">);</span>
    <span style="color:#00a8c8">int</span> <span style="color:#111">numTransform</span> <span style="color:#f92672">=</span> <span style="color:#111">cbrtNX</span><span style="color:#f92672">*</span><span style="color:#111">cbrtNX</span><span style="color:#111">;</span>

    <span style="color:#00a8c8">int</span> <span style="color:#111">paramsMatrix</span><span style="color:#111">[</span><span style="color:#ae81ff">3</span><span style="color:#111">][</span><span style="color:#ae81ff">5</span><span style="color:#111">]</span> <span style="color:#f92672">=</span> <span style="color:#111">{{</span><span style="color:#111">cbrtNX</span><span style="color:#f92672">*</span><span style="color:#111">cbrtNX</span><span style="color:#111">,</span><span style="color:#ae81ff">1</span><span style="color:#111">,</span><span style="color:#ae81ff">1</span><span style="color:#111">,</span><span style="color:#111">cbrtNX</span><span style="color:#111">,</span><span style="color:#ae81ff">0</span><span style="color:#111">},{</span><span style="color:#111">cbrtNX</span><span style="color:#111">,</span><span style="color:#111">cbrtNX</span><span style="color:#111">,</span><span style="color:#111">cbrtNX</span><span style="color:#111">,</span><span style="color:#ae81ff">1</span><span style="color:#111">,</span><span style="color:#111">cbrtNX</span><span style="color:#f92672">*</span><span style="color:#111">cbrtNX</span><span style="color:#111">},{</span><span style="color:#111">cbrtNX</span><span style="color:#f92672">*</span><span style="color:#111">cbrtNX</span><span style="color:#111">,</span><span style="color:#ae81ff">1</span><span style="color:#111">,</span><span style="color:#111">cbrtNX</span><span style="color:#f92672">*</span><span style="color:#111">cbrtNX</span><span style="color:#111">,</span><span style="color:#ae81ff">1</span><span style="color:#111">,</span><span style="color:#ae81ff">0</span><span style="color:#111">}};</span>
    <span style="color:#111">FTParams</span> <span style="color:#111">params</span><span style="color:#111">[</span><span style="color:#ae81ff">3</span><span style="color:#111">];</span>

    <span style="color:#00a8c8">for</span><span style="color:#111">(</span><span style="color:#00a8c8">int</span> <span style="color:#111">ii</span><span style="color:#f92672">=</span><span style="color:#ae81ff">0</span><span style="color:#111">;</span> <span style="color:#111">ii</span><span style="color:#f92672">&lt;</span><span style="color:#ae81ff">3</span><span style="color:#111">;</span> <span style="color:#f92672">++</span><span style="color:#111">ii</span><span style="color:#111">){</span>
        <span style="color:#111">params</span><span style="color:#111">[</span><span style="color:#111">ii</span><span style="color:#111">].</span><span style="color:#111">numTranforms</span> <span style="color:#f92672">=</span> <span style="color:#111">paramsMatrix</span><span style="color:#111">[</span><span style="color:#111">ii</span><span style="color:#111">][</span><span style="color:#ae81ff">0</span><span style="color:#111">];</span>
        <span style="color:#111">params</span><span style="color:#111">[</span><span style="color:#111">ii</span><span style="color:#111">].</span><span style="color:#111">numLoops</span> <span style="color:#f92672">=</span> <span style="color:#111">paramsMatrix</span><span style="color:#111">[</span><span style="color:#111">ii</span><span style="color:#111">][</span><span style="color:#ae81ff">1</span><span style="color:#111">];</span>
        <span style="color:#111">params</span><span style="color:#111">[</span><span style="color:#111">ii</span><span style="color:#111">].</span><span style="color:#111">stride</span> <span style="color:#f92672">=</span> <span style="color:#111">paramsMatrix</span><span style="color:#111">[</span><span style="color:#111">ii</span><span style="color:#111">][</span><span style="color:#ae81ff">2</span><span style="color:#111">];</span>
        <span style="color:#111">params</span><span style="color:#111">[</span><span style="color:#111">ii</span><span style="color:#111">].</span><span style="color:#111">dist</span> <span style="color:#f92672">=</span> <span style="color:#111">paramsMatrix</span><span style="color:#111">[</span><span style="color:#111">ii</span><span style="color:#111">][</span><span style="color:#ae81ff">3</span><span style="color:#111">];</span>
        <span style="color:#111">params</span><span style="color:#111">[</span><span style="color:#111">ii</span><span style="color:#111">].</span><span style="color:#111">offset</span> <span style="color:#f92672">=</span> <span style="color:#111">paramsMatrix</span><span style="color:#111">[</span><span style="color:#111">ii</span><span style="color:#111">][</span><span style="color:#ae81ff">4</span><span style="color:#111">];</span>
    <span style="color:#111">}</span>

    <span style="color:#00a8c8">int</span> <span style="color:#111">dims</span><span style="color:#111">[]</span> <span style="color:#f92672">=</span> <span style="color:#111">{</span><span style="color:#111">NX</span><span style="color:#111">};</span>
    <span style="color:#00a8c8">int</span> <span style="color:#111">dims3D</span><span style="color:#111">[]</span> <span style="color:#f92672">=</span> <span style="color:#111">{</span><span style="color:#111">cbrtNX</span><span style="color:#111">,</span><span style="color:#111">cbrtNX</span><span style="color:#111">,</span><span style="color:#111">cbrtNX</span><span style="color:#111">};</span>

    <span style="color:#00a8c8">int</span> <span style="color:#111">inembed</span><span style="color:#111">[]</span> <span style="color:#f92672">=</span> <span style="color:#111">{</span><span style="color:#111">cbrtNX</span><span style="color:#111">,</span><span style="color:#111">cbrtNX</span><span style="color:#111">,</span><span style="color:#111">cbrtNX</span><span style="color:#111">};</span>
    <span style="color:#00a8c8">int</span> <span style="color:#111">onembed</span><span style="color:#111">[]</span> <span style="color:#f92672">=</span> <span style="color:#111">{</span><span style="color:#111">cbrtNX</span><span style="color:#111">,</span><span style="color:#111">cbrtNX</span><span style="color:#111">,</span><span style="color:#111">cbrtNX</span><span style="color:#111">};</span>
    <span style="color:#00a8c8">int</span> <span style="color:#111">istride</span><span style="color:#111">[]</span> <span style="color:#f92672">=</span> <span style="color:#111">{</span><span style="color:#ae81ff">1</span><span style="color:#111">,</span><span style="color:#111">cbrtNX</span><span style="color:#111">,</span><span style="color:#111">cbrtNX</span><span style="color:#f92672">*</span><span style="color:#111">cbrtNX</span><span style="color:#111">};</span> <span style="color:#75715e">// Indexed value is respective dimensionality of the transform along a specific dimension.
</span><span style="color:#75715e"></span>    <span style="color:#00a8c8">int</span> <span style="color:#111">ostride</span><span style="color:#111">[]</span> <span style="color:#f92672">=</span> <span style="color:#111">{</span><span style="color:#ae81ff">1</span><span style="color:#111">,</span><span style="color:#111">cbrtNX</span><span style="color:#111">,</span><span style="color:#111">cbrtNX</span><span style="color:#f92672">*</span><span style="color:#111">cbrtNX</span><span style="color:#111">};</span>
    <span style="color:#00a8c8">int</span> <span style="color:#111">idist</span><span style="color:#111">[]</span> <span style="color:#f92672">=</span> <span style="color:#111">{</span><span style="color:#111">cbrtNX</span><span style="color:#111">,</span><span style="color:#ae81ff">1</span><span style="color:#111">,</span><span style="color:#ae81ff">1</span><span style="color:#111">};</span> <span style="color:#75715e">// [Here][] // The next dimension
</span><span style="color:#75715e"></span>    <span style="color:#00a8c8">int</span> <span style="color:#111">odist</span><span style="color:#111">[]</span> <span style="color:#f92672">=</span> <span style="color:#111">{</span><span style="color:#111">cbrtNX</span><span style="color:#111">,</span><span style="color:#ae81ff">1</span><span style="color:#111">,</span><span style="color:#ae81ff">1</span><span style="color:#111">};</span>

    <span style="color:#111">cufftHandle</span> <span style="color:#111">planMany</span><span style="color:#111">,</span> <span style="color:#111">plan1D</span><span style="color:#111">,</span> <span style="color:#111">plan3D</span><span style="color:#111">;</span>
    <span style="color:#111">cufftDoubleComplex</span> <span style="color:#f92672">*</span><span style="color:#111">data_H1DFFT</span><span style="color:#111">,</span> <span style="color:#f92672">*</span><span style="color:#111">data_HmanyFFT</span><span style="color:#111">,</span> <span style="color:#f92672">*</span><span style="color:#111">data_H0</span><span style="color:#111">,</span> <span style="color:#f92672">*</span><span style="color:#111">data_D</span><span style="color:#111">;</span>

    <span style="color:#111">ERR_CHECK</span><span style="color:#111">(</span> <span style="color:#111">cudaMalloc</span><span style="color:#111">(</span> <span style="color:#111">(</span><span style="color:#111">cufftDoubleComplex</span><span style="color:#f92672">**</span><span style="color:#111">)</span> <span style="color:#f92672">&amp;</span><span style="color:#111">data_D</span><span style="color:#111">,</span> <span style="color:#00a8c8">sizeof</span><span style="color:#111">(</span><span style="color:#111">cufftDoubleComplex</span><span style="color:#111">)</span><span style="color:#f92672">*</span><span style="color:#111">NX</span><span style="color:#111">)</span> <span style="color:#111">);</span>

    <span style="color:#111">data_H1DFFT</span> <span style="color:#f92672">=</span> <span style="color:#111">(</span><span style="color:#111">cufftDoubleComplex</span><span style="color:#f92672">*</span><span style="color:#111">)</span> <span style="color:#111">malloc</span><span style="color:#111">(</span><span style="color:#00a8c8">sizeof</span><span style="color:#111">(</span><span style="color:#111">cufftDoubleComplex</span><span style="color:#111">)</span><span style="color:#f92672">*</span><span style="color:#111">NX</span><span style="color:#111">);</span>
    <span style="color:#111">data_HmanyFFT</span> <span style="color:#f92672">=</span> <span style="color:#111">(</span><span style="color:#111">cufftDoubleComplex</span><span style="color:#f92672">*</span><span style="color:#111">)</span> <span style="color:#111">malloc</span><span style="color:#111">(</span><span style="color:#00a8c8">sizeof</span><span style="color:#111">(</span><span style="color:#111">cufftDoubleComplex</span><span style="color:#111">)</span><span style="color:#f92672">*</span><span style="color:#111">NX</span><span style="color:#111">);</span>
    <span style="color:#111">data_H0</span> <span style="color:#f92672">=</span> <span style="color:#111">(</span><span style="color:#111">cufftDoubleComplex</span><span style="color:#f92672">*</span><span style="color:#111">)</span> <span style="color:#111">malloc</span><span style="color:#111">(</span><span style="color:#00a8c8">sizeof</span><span style="color:#111">(</span><span style="color:#111">cufftDoubleComplex</span><span style="color:#111">)</span><span style="color:#f92672">*</span><span style="color:#111">NX</span><span style="color:#111">);</span>

    <span style="color:#75715e">// ******************************************************************************** //
</span><span style="color:#75715e"></span>    <span style="color:#75715e">// Create the input data
</span><span style="color:#75715e"></span>    <span style="color:#75715e">// ******************************************************************************** //
</span><span style="color:#75715e"></span>    <span style="color:#111">std</span><span style="color:#f92672">::</span><span style="color:#111">cout</span> <span style="color:#f92672">&lt;&lt;</span> <span style="color:#d88200">&#34;INPUT:</span><span style="color:#8045ff">\n</span><span style="color:#d88200">&#34;</span><span style="color:#111">;</span>
    <span style="color:#00a8c8">for</span><span style="color:#111">(</span><span style="color:#00a8c8">int</span> <span style="color:#111">ii</span><span style="color:#f92672">=</span><span style="color:#ae81ff">0</span><span style="color:#111">;</span> <span style="color:#111">ii</span><span style="color:#f92672">&lt;</span><span style="color:#111">cbrtNX</span><span style="color:#111">;</span> <span style="color:#f92672">++</span><span style="color:#111">ii</span><span style="color:#111">){</span>
		<span style="color:#111">std</span><span style="color:#f92672">::</span><span style="color:#111">cout</span> <span style="color:#f92672">&lt;&lt;</span> <span style="color:#d88200">&#34;C(:,:,&#34;</span> <span style="color:#f92672">&lt;&lt;</span> <span style="color:#111">ii</span><span style="color:#f92672">+</span><span style="color:#ae81ff">1</span> <span style="color:#f92672">&lt;&lt;</span> <span style="color:#d88200">&#34;)=[&#34;</span><span style="color:#111">;</span>
        <span style="color:#00a8c8">for</span><span style="color:#111">(</span><span style="color:#00a8c8">int</span> <span style="color:#111">jj</span><span style="color:#f92672">=</span><span style="color:#ae81ff">0</span><span style="color:#111">;</span> <span style="color:#111">jj</span><span style="color:#f92672">&lt;</span><span style="color:#111">cbrtNX</span><span style="color:#111">;</span> <span style="color:#f92672">++</span><span style="color:#111">jj</span><span style="color:#111">){</span>
            <span style="color:#00a8c8">for</span><span style="color:#111">(</span><span style="color:#00a8c8">int</span> <span style="color:#111">kk</span><span style="color:#f92672">=</span><span style="color:#ae81ff">0</span><span style="color:#111">;</span> <span style="color:#111">kk</span><span style="color:#f92672">&lt;</span><span style="color:#111">cbrtNX</span><span style="color:#111">;</span> <span style="color:#f92672">++</span><span style="color:#111">kk</span><span style="color:#111">){</span>
                <span style="color:#111">data_H0</span><span style="color:#111">[</span><span style="color:#111">kk</span> <span style="color:#f92672">+</span> <span style="color:#111">cbrtNX</span><span style="color:#f92672">*</span><span style="color:#111">(</span><span style="color:#111">jj</span> <span style="color:#f92672">+</span> <span style="color:#111">ii</span><span style="color:#f92672">*</span><span style="color:#111">cbrtNX</span><span style="color:#111">)].</span><span style="color:#111">x</span> <span style="color:#f92672">=</span> <span style="color:#111">(</span><span style="color:#00a8c8">double</span><span style="color:#111">)</span> <span style="color:#111">ii</span><span style="color:#111">;</span>
                <span style="color:#111">data_H0</span><span style="color:#111">[</span><span style="color:#111">kk</span> <span style="color:#f92672">+</span> <span style="color:#111">cbrtNX</span><span style="color:#f92672">*</span><span style="color:#111">(</span><span style="color:#111">jj</span> <span style="color:#f92672">+</span> <span style="color:#111">ii</span><span style="color:#f92672">*</span><span style="color:#111">cbrtNX</span><span style="color:#111">)].</span><span style="color:#111">y</span> <span style="color:#f92672">=</span> <span style="color:#111">(</span><span style="color:#00a8c8">double</span><span style="color:#111">)</span> <span style="color:#111">jj</span><span style="color:#111">;</span><span style="color:#75715e">//(double) jj;
</span><span style="color:#75715e"></span>                <span style="color:#111">std</span><span style="color:#f92672">::</span><span style="color:#111">cout</span> <span style="color:#f92672">&lt;&lt;</span> <span style="color:#111">data_H0</span><span style="color:#111">[</span><span style="color:#111">kk</span> <span style="color:#f92672">+</span> <span style="color:#111">cbrtNX</span><span style="color:#f92672">*</span><span style="color:#111">(</span><span style="color:#111">jj</span> <span style="color:#f92672">+</span> <span style="color:#111">ii</span><span style="color:#f92672">*</span><span style="color:#111">cbrtNX</span><span style="color:#111">)].</span><span style="color:#111">x</span> <span style="color:#f92672">&lt;&lt;</span> <span style="color:#d88200">&#34; + 1i*&#34;</span> <span style="color:#f92672">&lt;&lt;</span> <span style="color:#111">data_H0</span><span style="color:#111">[</span><span style="color:#111">kk</span> <span style="color:#f92672">+</span> <span style="color:#111">cbrtNX</span><span style="color:#f92672">*</span><span style="color:#111">(</span><span style="color:#111">jj</span> <span style="color:#f92672">+</span> <span style="color:#111">ii</span><span style="color:#f92672">*</span><span style="color:#111">cbrtNX</span><span style="color:#111">)].</span><span style="color:#111">y</span> <span style="color:#f92672">&lt;&lt;</span> <span style="color:#d88200">&#34;</span><span style="color:#8045ff">\t</span><span style="color:#d88200">&#34;</span><span style="color:#111">;</span>
            <span style="color:#111">}</span>
            <span style="color:#111">std</span><span style="color:#f92672">::</span><span style="color:#111">cout</span> <span style="color:#f92672">&lt;&lt;</span> <span style="color:#d88200">&#34;</span><span style="color:#8045ff">\n</span><span style="color:#d88200">&#34;</span><span style="color:#111">;</span>
        <span style="color:#111">}</span>
        <span style="color:#111">std</span><span style="color:#f92672">::</span><span style="color:#111">cout</span> <span style="color:#f92672">&lt;&lt;</span> <span style="color:#d88200">&#34;]</span><span style="color:#8045ff">\n</span><span style="color:#d88200">&#34;</span><span style="color:#111">;</span>
    <span style="color:#111">}</span>
    <span style="color:#111">std</span><span style="color:#f92672">::</span><span style="color:#111">cout</span> <span style="color:#f92672">&lt;&lt;</span> <span style="color:#d88200">&#34;</span><span style="color:#8045ff">\n</span><span style="color:#d88200"> --- </span><span style="color:#8045ff">\n</span><span style="color:#d88200">&#34;</span><span style="color:#111">;</span>

    <span style="color:#111">ERR_CHECK</span><span style="color:#111">(</span> <span style="color:#111">cudaMemcpy</span><span style="color:#111">(</span><span style="color:#111">data_D</span><span style="color:#111">,</span> <span style="color:#111">data_H0</span><span style="color:#111">,</span> <span style="color:#00a8c8">sizeof</span><span style="color:#111">(</span><span style="color:#111">cufftDoubleComplex</span><span style="color:#111">)</span> <span style="color:#f92672">*</span> <span style="color:#111">NX</span><span style="color:#111">,</span> <span style="color:#111">cudaMemcpyHostToDevice</span><span style="color:#111">));</span>

    <span style="color:#75715e">// ******************************************************************************** //
</span><span style="color:#75715e"></span>    <span style="color:#75715e">// First, check the 1D FFT along the standard dimension
</span><span style="color:#75715e"></span>    <span style="color:#75715e">// ******************************************************************************** //
</span><span style="color:#75715e"></span>    <span style="color:#111">FFT_ERR_CHECK</span><span style="color:#111">(</span><span style="color:#111">cufftPlan1d</span><span style="color:#111">(</span><span style="color:#f92672">&amp;</span><span style="color:#111">plan1D</span><span style="color:#111">,</span> <span style="color:#111">cbrtNX</span><span style="color:#111">,</span> <span style="color:#111">CUFFT_Z2Z</span><span style="color:#111">,</span> <span style="color:#111">cbrtNX</span><span style="color:#f92672">*</span><span style="color:#111">cbrtNX</span><span style="color:#111">));</span>
    <span style="color:#111">FFT_ERR_CHECK</span><span style="color:#111">(</span><span style="color:#111">cufftExecZ2Z</span><span style="color:#111">(</span><span style="color:#111">plan1D</span><span style="color:#111">,</span> <span style="color:#111">data_D</span><span style="color:#111">,</span> <span style="color:#111">data_D</span><span style="color:#111">,</span> <span style="color:#111">CUFFT_FORWARD</span><span style="color:#111">));</span>
    <span style="color:#111">ERR_CHECK</span><span style="color:#111">(</span><span style="color:#111">cudaMemcpy</span><span style="color:#111">(</span><span style="color:#111">data_H1DFFT</span><span style="color:#111">,</span> <span style="color:#111">data_D</span><span style="color:#111">,</span> <span style="color:#00a8c8">sizeof</span><span style="color:#111">(</span><span style="color:#111">cufftDoubleComplex</span><span style="color:#111">)</span> <span style="color:#f92672">*</span> <span style="color:#111">NX</span><span style="color:#111">,</span> <span style="color:#111">cudaMemcpyDeviceToHost</span><span style="color:#111">));</span>
    <span style="color:#111">std</span><span style="color:#f92672">::</span><span style="color:#111">cout</span> <span style="color:#f92672">&lt;&lt;</span> <span style="color:#d88200">&#34;OUTPUT 1D_1:</span><span style="color:#8045ff">\n</span><span style="color:#d88200">&#34;</span><span style="color:#111">;</span>
    <span style="color:#00a8c8">for</span><span style="color:#111">(</span><span style="color:#00a8c8">int</span> <span style="color:#111">ii</span><span style="color:#f92672">=</span><span style="color:#ae81ff">0</span><span style="color:#111">;</span> <span style="color:#111">ii</span><span style="color:#f92672">&lt;</span><span style="color:#111">cbrtNX</span><span style="color:#111">;</span> <span style="color:#f92672">++</span><span style="color:#111">ii</span><span style="color:#111">){</span>
        <span style="color:#00a8c8">for</span><span style="color:#111">(</span><span style="color:#00a8c8">int</span> <span style="color:#111">jj</span><span style="color:#f92672">=</span><span style="color:#ae81ff">0</span><span style="color:#111">;</span> <span style="color:#111">jj</span><span style="color:#f92672">&lt;</span><span style="color:#111">cbrtNX</span><span style="color:#111">;</span> <span style="color:#f92672">++</span><span style="color:#111">jj</span><span style="color:#111">){</span>
            <span style="color:#00a8c8">for</span><span style="color:#111">(</span><span style="color:#00a8c8">int</span> <span style="color:#111">kk</span><span style="color:#f92672">=</span><span style="color:#ae81ff">0</span><span style="color:#111">;</span> <span style="color:#111">kk</span><span style="color:#f92672">&lt;</span><span style="color:#111">cbrtNX</span><span style="color:#111">;</span> <span style="color:#f92672">++</span><span style="color:#111">kk</span><span style="color:#111">){</span>
                <span style="color:#111">std</span><span style="color:#f92672">::</span><span style="color:#111">cout</span> <span style="color:#f92672">&lt;&lt;</span> <span style="color:#111">data_H1DFFT</span><span style="color:#111">[</span><span style="color:#111">kk</span> <span style="color:#f92672">+</span> <span style="color:#111">cbrtNX</span><span style="color:#f92672">*</span><span style="color:#111">(</span><span style="color:#111">jj</span> <span style="color:#f92672">+</span> <span style="color:#111">ii</span><span style="color:#f92672">*</span><span style="color:#111">cbrtNX</span><span style="color:#111">)].</span><span style="color:#111">x</span> <span style="color:#f92672">&lt;&lt;</span> <span style="color:#d88200">&#34; + 1i*&#34;</span> <span style="color:#f92672">&lt;&lt;</span> <span style="color:#111">data_H1DFFT</span><span style="color:#111">[</span><span style="color:#111">kk</span> <span style="color:#f92672">+</span> <span style="color:#111">cbrtNX</span><span style="color:#f92672">*</span><span style="color:#111">(</span><span style="color:#111">jj</span> <span style="color:#f92672">+</span> <span style="color:#111">ii</span><span style="color:#f92672">*</span><span style="color:#111">cbrtNX</span><span style="color:#111">)].</span><span style="color:#111">y</span> <span style="color:#f92672">&lt;&lt;</span> <span style="color:#d88200">&#34;</span><span style="color:#8045ff">\t</span><span style="color:#d88200">&#34;</span><span style="color:#111">;</span>
            <span style="color:#111">}</span>
            <span style="color:#111">std</span><span style="color:#f92672">::</span><span style="color:#111">cout</span> <span style="color:#f92672">&lt;&lt;</span> <span style="color:#d88200">&#34;</span><span style="color:#8045ff">\n</span><span style="color:#d88200">&#34;</span><span style="color:#111">;</span>
        <span style="color:#111">}</span>
        <span style="color:#111">std</span><span style="color:#f92672">::</span><span style="color:#111">cout</span> <span style="color:#f92672">&lt;&lt;</span> <span style="color:#d88200">&#34;</span><span style="color:#8045ff">\n</span><span style="color:#d88200">&#34;</span><span style="color:#111">;</span>
    <span style="color:#111">}</span>
    <span style="color:#111">std</span><span style="color:#f92672">::</span><span style="color:#111">cout</span> <span style="color:#f92672">&lt;&lt;</span> <span style="color:#d88200">&#34;</span><span style="color:#8045ff">\n</span><span style="color:#d88200"> --- </span><span style="color:#8045ff">\n</span><span style="color:#d88200">&#34;</span><span style="color:#111">;</span>

    <span style="color:#75715e">//Overwrite GPU data to original values
</span><span style="color:#75715e"></span>    <span style="color:#111">ERR_CHECK</span><span style="color:#111">(</span> <span style="color:#111">cudaMemcpy</span><span style="color:#111">(</span><span style="color:#111">data_D</span><span style="color:#111">,</span> <span style="color:#111">data_H0</span><span style="color:#111">,</span> <span style="color:#00a8c8">sizeof</span><span style="color:#111">(</span><span style="color:#111">cufftDoubleComplex</span><span style="color:#111">)</span> <span style="color:#f92672">*</span> <span style="color:#111">NX</span><span style="color:#111">,</span> <span style="color:#111">cudaMemcpyHostToDevice</span><span style="color:#111">));</span>

    <span style="color:#75715e">// ******************************************************************************** //
</span><span style="color:#75715e"></span>    <span style="color:#75715e">// ******************************************************************************** //
</span><span style="color:#75715e"></span>    <span style="color:#75715e">// Next, check the Many FFT along the same expected dimension
</span><span style="color:#75715e"></span>    <span style="color:#75715e">// ******************************************************************************** //
</span><span style="color:#75715e"></span>    <span style="color:#00a8c8">int</span> <span style="color:#111">tDim</span> <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span><span style="color:#111">;</span> <span style="color:#75715e">//Transform dimension
</span><span style="color:#75715e"></span>
    <span style="color:#00a8c8">int</span> <span style="color:#111">dims2D</span><span style="color:#111">[]</span> <span style="color:#f92672">=</span> <span style="color:#111">{</span><span style="color:#111">cbrtNX</span><span style="color:#111">,</span><span style="color:#111">cbrtNX</span><span style="color:#111">};</span>
    <span style="color:#111">FFT_ERR_CHECK</span><span style="color:#111">(</span><span style="color:#111">cufftPlanMany</span><span style="color:#111">(</span><span style="color:#f92672">&amp;</span><span style="color:#111">planMany</span><span style="color:#111">,</span> <span style="color:#ae81ff">1</span><span style="color:#111">,</span> <span style="color:#111">dims2D</span><span style="color:#111">,</span> <span style="color:#111">inembed</span><span style="color:#111">,</span> <span style="color:#111">cbrtNX</span><span style="color:#111">,</span> <span style="color:#ae81ff">1</span><span style="color:#111">,</span> <span style="color:#111">onembed</span><span style="color:#111">,</span> <span style="color:#111">cbrtNX</span><span style="color:#111">,</span> <span style="color:#ae81ff">1</span><span style="color:#111">,</span> <span style="color:#111">CUFFT_Z2Z</span><span style="color:#111">,</span> <span style="color:#111">cbrtNX</span><span style="color:#111">));</span>
    <span style="color:#00a8c8">for</span> <span style="color:#111">(</span><span style="color:#00a8c8">int</span> <span style="color:#111">ii</span><span style="color:#f92672">=</span><span style="color:#ae81ff">0</span><span style="color:#111">;</span> <span style="color:#111">ii</span><span style="color:#f92672">&lt;</span><span style="color:#111">cbrtNX</span><span style="color:#111">;</span> <span style="color:#f92672">++</span><span style="color:#111">ii</span><span style="color:#111">){</span>
        <span style="color:#111">FFT_ERR_CHECK</span><span style="color:#111">(</span><span style="color:#111">cufftExecZ2Z</span><span style="color:#111">(</span><span style="color:#111">planMany</span><span style="color:#111">,</span> <span style="color:#f92672">&amp;</span><span style="color:#111">data_D</span><span style="color:#111">[</span><span style="color:#111">ii</span><span style="color:#f92672">*</span><span style="color:#111">cbrtNX</span><span style="color:#f92672">*</span><span style="color:#111">cbrtNX</span><span style="color:#111">],</span> <span style="color:#f92672">&amp;</span><span style="color:#111">data_D</span><span style="color:#111">[</span><span style="color:#111">ii</span><span style="color:#f92672">*</span><span style="color:#111">cbrtNX</span><span style="color:#f92672">*</span><span style="color:#111">cbrtNX</span><span style="color:#111">]</span> <span style="color:#111">,</span> <span style="color:#111">CUFFT_FORWARD</span><span style="color:#111">));</span>
    <span style="color:#111">}</span>

    <span style="color:#111">ERR_CHECK</span><span style="color:#111">(</span><span style="color:#111">cudaMemcpy</span><span style="color:#111">(</span><span style="color:#111">data_HmanyFFT</span><span style="color:#111">,</span> <span style="color:#111">data_D</span><span style="color:#111">,</span> <span style="color:#00a8c8">sizeof</span><span style="color:#111">(</span><span style="color:#111">cufftDoubleComplex</span><span style="color:#111">)</span> <span style="color:#f92672">*</span> <span style="color:#111">NX</span><span style="color:#111">,</span> <span style="color:#111">cudaMemcpyDeviceToHost</span><span style="color:#111">));</span>

    <span style="color:#111">std</span><span style="color:#f92672">::</span><span style="color:#111">cout</span> <span style="color:#f92672">&lt;&lt;</span> <span style="color:#d88200">&#34;OUTPUT MANY 1D:</span><span style="color:#8045ff">\n</span><span style="color:#d88200">&#34;</span><span style="color:#111">;</span>
    <span style="color:#00a8c8">for</span><span style="color:#111">(</span><span style="color:#00a8c8">int</span> <span style="color:#111">ii</span><span style="color:#f92672">=</span><span style="color:#ae81ff">0</span><span style="color:#111">;</span> <span style="color:#111">ii</span><span style="color:#f92672">&lt;</span><span style="color:#111">cbrtNX</span><span style="color:#111">;</span> <span style="color:#f92672">++</span><span style="color:#111">ii</span><span style="color:#111">){</span>
        <span style="color:#00a8c8">for</span><span style="color:#111">(</span><span style="color:#00a8c8">int</span> <span style="color:#111">jj</span><span style="color:#f92672">=</span><span style="color:#ae81ff">0</span><span style="color:#111">;</span> <span style="color:#111">jj</span><span style="color:#f92672">&lt;</span><span style="color:#111">cbrtNX</span><span style="color:#111">;</span> <span style="color:#f92672">++</span><span style="color:#111">jj</span><span style="color:#111">){</span>
            <span style="color:#00a8c8">for</span><span style="color:#111">(</span><span style="color:#00a8c8">int</span> <span style="color:#111">kk</span><span style="color:#f92672">=</span><span style="color:#ae81ff">0</span><span style="color:#111">;</span> <span style="color:#111">kk</span><span style="color:#f92672">&lt;</span><span style="color:#111">cbrtNX</span><span style="color:#111">;</span> <span style="color:#f92672">++</span><span style="color:#111">kk</span><span style="color:#111">){</span>
                <span style="color:#111">std</span><span style="color:#f92672">::</span><span style="color:#111">cout</span> <span style="color:#f92672">&lt;&lt;</span> <span style="color:#111">data_HmanyFFT</span><span style="color:#111">[</span><span style="color:#111">kk</span> <span style="color:#f92672">+</span> <span style="color:#111">cbrtNX</span><span style="color:#f92672">*</span><span style="color:#111">(</span><span style="color:#111">jj</span> <span style="color:#f92672">+</span> <span style="color:#111">ii</span><span style="color:#f92672">*</span><span style="color:#111">cbrtNX</span><span style="color:#111">)].</span><span style="color:#111">x</span> <span style="color:#f92672">&lt;&lt;</span> <span style="color:#d88200">&#34; + 1i*&#34;</span> <span style="color:#f92672">&lt;&lt;</span> <span style="color:#111">data_HmanyFFT</span><span style="color:#111">[</span><span style="color:#111">kk</span> <span style="color:#f92672">+</span> <span style="color:#111">cbrtNX</span><span style="color:#f92672">*</span><span style="color:#111">(</span><span style="color:#111">jj</span> <span style="color:#f92672">+</span> <span style="color:#111">ii</span><span style="color:#f92672">*</span><span style="color:#111">cbrtNX</span><span style="color:#111">)].</span><span style="color:#111">y</span> <span style="color:#f92672">&lt;&lt;</span> <span style="color:#d88200">&#34;</span><span style="color:#8045ff">\t</span><span style="color:#d88200">&#34;</span><span style="color:#111">;</span>
            <span style="color:#111">}</span>
            <span style="color:#111">std</span><span style="color:#f92672">::</span><span style="color:#111">cout</span> <span style="color:#f92672">&lt;&lt;</span> <span style="color:#d88200">&#34;</span><span style="color:#8045ff">\n</span><span style="color:#d88200">&#34;</span><span style="color:#111">;</span>
        <span style="color:#111">}</span>
        <span style="color:#111">std</span><span style="color:#f92672">::</span><span style="color:#111">cout</span> <span style="color:#f92672">&lt;&lt;</span> <span style="color:#d88200">&#34;</span><span style="color:#8045ff">\n</span><span style="color:#d88200">&#34;</span><span style="color:#111">;</span>
    <span style="color:#111">}</span>
    <span style="color:#111">std</span><span style="color:#f92672">::</span><span style="color:#111">cout</span> <span style="color:#f92672">&lt;&lt;</span> <span style="color:#d88200">&#34;</span><span style="color:#8045ff">\n</span><span style="color:#d88200"> --- </span><span style="color:#8045ff">\n</span><span style="color:#d88200">&#34;</span><span style="color:#111">;</span>

    <span style="color:#75715e">//Overwrite GPU data to original values
</span><span style="color:#75715e"></span>    <span style="color:#111">ERR_CHECK</span><span style="color:#111">(</span> <span style="color:#111">cudaMemcpy</span><span style="color:#111">(</span><span style="color:#111">data_D</span><span style="color:#111">,</span> <span style="color:#111">data_H0</span><span style="color:#111">,</span> <span style="color:#00a8c8">sizeof</span><span style="color:#111">(</span><span style="color:#111">cufftDoubleComplex</span><span style="color:#111">)</span> <span style="color:#f92672">*</span> <span style="color:#111">NX</span><span style="color:#111">,</span> <span style="color:#111">cudaMemcpyHostToDevice</span><span style="color:#111">));</span>

    <span style="color:#75715e">// ******************************************************************************** //
</span><span style="color:#75715e"></span>    <span style="color:#75715e">// ******************************************************************************** //
</span><span style="color:#75715e"></span>    <span style="color:#75715e">// Free stuff
</span><span style="color:#75715e"></span>    <span style="color:#75715e">// ******************************************************************************** //
</span><span style="color:#75715e"></span>
    <span style="color:#111">cufftDestroy</span><span style="color:#111">(</span><span style="color:#111">planMany</span><span style="color:#111">);</span><span style="color:#111">cufftDestroy</span><span style="color:#111">(</span><span style="color:#111">plan1D</span><span style="color:#111">);</span><span style="color:#111">cufftDestroy</span><span style="color:#111">(</span><span style="color:#111">plan3D</span><span style="color:#111">);</span>
    <span style="color:#111">cudaFree</span><span style="color:#111">(</span><span style="color:#111">data_D</span><span style="color:#111">);</span>
    <span style="color:#111">free</span><span style="color:#111">(</span><span style="color:#111">data_HmanyFFT</span><span style="color:#111">);</span><span style="color:#111">free</span><span style="color:#111">(</span><span style="color:#111">data_H1DFFT</span><span style="color:#111">);</span><span style="color:#111">free</span><span style="color:#111">(</span><span style="color:#111">data_H0</span><span style="color:#111">);</span>
<span style="color:#111">}</span>

<span style="color:#00a8c8">int</span> <span style="color:#75af00">main</span><span style="color:#111">(</span><span style="color:#00a8c8">void</span><span style="color:#111">)</span> <span style="color:#111">{</span>
    <span style="color:#111">fftMulti3D</span><span style="color:#111">();</span>
    <span style="color:#111">ERR_CHECK</span><span style="color:#111">(</span><span style="color:#111">cudaDeviceReset</span><span style="color:#111">());</span>
    <span style="color:#00a8c8">return</span> <span style="color:#111">(</span><span style="color:#ae81ff">0</span><span style="color:#111">);</span>
<span style="color:#111">}</span>
</code></pre></div>
<p>Compiling the above code using <code>nvcc ./multiDFFT.cu -o mdfft -lcufft</code> will showcase this method. By performing the FFT in this manner we can achieve approximately 25% improvement over the original 2DF-1DI method. Given that we can make use of the CuFFT internal operations for in-place transforms also allows us to enable memory usage to examine much larger systems sizes without hitting the memory limit (or run the 3D code on smaller consumer GPUs).</p>

<script type="text/javascript" async
  src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.4/MathJax.js?config=TeX-MML-AM_CHTML">
</script>
<script type="text/x-mathjax-config">
MathJax.Hub.Config({
  tex2jax: {
    inlineMath: [['$','$'], ['\\(','\\)']],
    displayMath: [['$$','$$'], ['\[','\]']],
    processEscapes: true,
    processEnvironments: true,
    skipTags: ['script', 'noscript', 'style', 'textarea', 'pre','code'],
    TeX: { equationNumbers: { autoNumber: "AMS" },
         extensions: ["AMSmath.js", "AMSsymbols.js"] }
  }
});
</script>



    
    
        <div class="chevrons">
    <div id="navigation">
<a class="nav nav-prev" href="/data_analysis/gpue_build/" title=""> <i class="fa fa-chevron-left"></i><label></label></a>
    <a class="nav nav-next" href="/development/gpue_build/" title="" style="margin-right: 0px;"><label></label><i class="fa fa-chevron-right"></i></a></div>
  </div>

  </section>
</article>

<footer>

<div class="footline">
    

    

  

    <div class="github-link">
      <a href="https://github.com/gpue-group/gpue-group.github.iodevelopment/_index.md" target="blank"><i class="fa fa-code-fork"></i>
        Improve this page</a>
    </div>
  </div>


	<div>


  
    Create a content/_footer.md file to customize the footer content
  



	</div>
</footer>

<script src="/js/clipboard.min.js"></script>

<link href="/css/featherlight.min.css" rel="stylesheet">
<script src="/js/featherlight.min.js"></script>



<script src="/theme-flex/script.js"></script>

    

    
    

    
  </body>
</html>